<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- åŸºç¡€è®¾ç½® -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>è¯·æˆ‘çš„æš„æš„å°æœ‹å‹æ¥å—ç¤¼ç‰©</title>
  
  <!-- æ€§èƒ½ä¼˜åŒ–ç›¸å…³metaæ ‡ç­¾ -->
  <meta name="theme-color" content="#F472B6">
  <meta name="color-scheme" content="dark light">
  <meta name="description" content="é€ç»™æš„æš„çš„ç‰¹åˆ«ç¤¼ç‰©">
  
  <!-- æµè§ˆå™¨å…¼å®¹æ€§ä¼˜åŒ– -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="HandheldFriendly" content="true">
  
  <!-- ç§»åŠ¨è®¾å¤‡ä¼˜åŒ– -->
  <meta name="format-detection" content="telephone=no, email=no, address=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ç»™æš„æš„çš„ç¤¼ç‰©">
  
  <!-- å¾®ä¿¡æµè§ˆå™¨å…¼å®¹æ€§ä¼˜åŒ– -->
  <meta name="wechat-enable-text-zoom-em" content="false">
  
  <!-- ç¤¾äº¤åˆ†äº«ä¼˜åŒ– -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="è¯·æˆ‘çš„æš„æš„å°æœ‹å‹æ¥å—ç¤¼ç‰©">
  <meta property="og:description" content="é€ç»™æš„æš„çš„ç‰¹åˆ«ç¤¼ç‰©">
  <meta property="og:site_name" content="ç»™æš„æš„çš„ç¤¼ç‰©">
  <meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='%23F9A8D4'/%3E%3Ctext x='100' y='110' font-size='40' text-anchor='middle' fill='white'%3Eâ¤%3C/text%3E%3C/svg%3E"%3E
  <meta property="og:url" content="/">
  
  <!-- ç¼“å­˜æ§åˆ¶ - å¯¹äºGitHub Pagesï¼Œé€‚å½“çš„ç¼“å­˜è®¾ç½®æœ‰åŠ©äºæ€§èƒ½ -->
  <meta http-equiv="Cache-Control" content="public, max-age=3600">
  <meta http-equiv="Pragma" content="public">
  
  <!-- é¢„è¿æ¥æç¤º -->
  <link rel="preconnect" href="https://github.com" crossorigin>
  <link rel="preconnect" href="https://githubusercontent.com" crossorigin>
  
  <!-- é¢„åŠ è½½å…³é”®èµ„æºæç¤º -->
  <link rel="preload" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='%23F9A8D4'/%3E%3Ctext x='100' y='110' font-size='40' text-anchor='middle' fill='white'%3Eâ¤%3C/text%3E%3C/svg%3E" as="image" type="image/svg+xml">
  <!-- æ·»åŠ favicon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' fill='%23F472B6'/%3E%3Ctext x='16' y='20' font-size='16' text-anchor='middle' fill='white'%3Eâ¤%3C/text%3E%3C/svg%3E" type="image/svg+xml">
  <!-- æ€§èƒ½ç›‘æ§è„šæœ¬ -->
  <script>
    // ç®€å•çš„æ€§èƒ½ç›‘æ§å·¥å…·
    const performanceMonitor = {
      startTime: performance.now(),
      metrics: {},
      
      // è®°å½•å…³é”®èŠ‚ç‚¹æ—¶é—´
      markPoint(name) {
        this.metrics[name] = performance.now() - this.startTime;
      },
      
      // è®¡ç®—èµ„æºåŠ è½½æ—¶é—´
      measureResourceLoad() {
        if ('performance' in window && 'getEntriesByType' in performance) {
          const resources = performance.getEntriesByType('resource');
          const totalLoadTime = resources.reduce((sum, resource) => sum + (resource.duration || 0), 0);
          this.metrics.totalResourcesLoadTime = totalLoadTime;
          this.metrics.resourceCount = resources.length;
        }
      },
      
      // è¾“å‡ºæ€§èƒ½æŠ¥å‘Š
      report() {
        this.measureResourceLoad();
        console.log('æ€§èƒ½ç›‘æ§æŠ¥å‘Š:', this.metrics);
        
        // ç®€å•çš„æ€§èƒ½è¯„åˆ†
        const score = this.calculateScore();
        console.log('æ€§èƒ½è¯„åˆ†:', score + '/100');
      },
      
      // è®¡ç®—ç®€å•çš„æ€§èƒ½è¯„åˆ†
      calculateScore() {
        let score = 100;
        const loadTime = this.metrics.pageLoad || 5000;
        
        // åŠ è½½æ—¶é—´è¯„åˆ†ï¼ˆåŸºäºGoogleçš„æ ¸å¿ƒWebæŒ‡æ ‡ï¼‰
        if (loadTime > 2000) score -= Math.min((loadTime - 2000) / 100, 40);
        
        // èµ„æºæ•°é‡è¯„åˆ†
        if (this.metrics.resourceCount > 50) score -= Math.min((this.metrics.resourceCount - 50) * 0.5, 20);
        
        return Math.max(0, Math.round(score));
      }
    };
    
    // è®°å½•DOMåŠ è½½å®Œæˆæ—¶é—´
    document.addEventListener('DOMContentLoaded', () => {
      performanceMonitor.markPoint('domContentLoaded');
    });
    
    // è®°å½•é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´
    window.addEventListener('load', () => {
      performanceMonitor.markPoint('pageLoad');
      
      // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿æ‰€æœ‰å¼‚æ­¥èµ„æºåŠ è½½å®Œæˆ
      setTimeout(() => {
        performanceMonitor.report();
      }, 2000);
    });
  </script>
  <!-- ä½¿ç”¨å†…è”å›¾æ ‡æˆ–ç³»ç»Ÿå­—ä½“æ›¿ä»£å¤–éƒ¨å›¾æ ‡åº“ï¼Œç¡®ä¿GitHub Pageså…¼å®¹æ€§ -->
  <style>
    /* æ›¿ä»£Font Awesomeçš„åŸºæœ¬å›¾æ ‡æ ·å¼ */
    .icon-heart::before {
      content: 'â¤';
    }
    .icon-star::before {
      content: 'â˜…';
    }
  </style>
  <!-- ä½¿ç”¨å†…è”Tailwind CSSæ›¿ä»£CDNï¼Œç¡®ä¿GitHub Pageså¯è®¿é—® -->
  <style>
    /* åŸºç¡€æ ·å¼ - ç§»é™¤å¤–éƒ¨å­—ä½“å¼•ç”¨ */
    
    :root {
      --sweet1: #F9A8D4;
      --sweet2: #C084FC;
      --sweet3: #F472B6;
    }
    
    /* æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨CSSå˜é‡ç¼“å­˜ */
    * {
      --btn-shadow: 0 10px 25px -5px rgba(244, 114, 182, 0.5), 0 8px 10px -6px rgba(192, 132, 252, 0.3);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: black;
      min-height: 100vh;
      overflow: hidden;
    }
    
    .font-cute {
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }
    
    /* æŒ‰é’®æ ·å¼ */
    .btn-gradient {
      background: linear-gradient(135deg, var(--sweet2) 0%, var(--sweet3) 100%);
      color: white;
      border: none;
      border-radius: 9999px;
      padding: clamp(0.8rem, 3vw, 1.5rem) clamp(1.5rem, 6vw, 3rem);
      font-size: clamp(0.75rem, 2.5vw, 1.1rem);
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: var(--btn-shadow);
      will-change: transform, box-shadow;
      transform: translateZ(0);
    }
    
    .btn-gradient:hover {
      box-shadow: 0 15px 30px -5px rgba(244, 114, 182, 0.7), 0 10px 15px -6px rgba(192, 132, 252, 0.5);
      transform: translateY(-3px);
    }
    
    .btn-gradient:active {
      transform: translateY(-1px);
    }
    
    /* ä¿¡å°æŒ‰é’®æ ·å¼ */
    .envelope-btn {
      position: relative;
      background: linear-gradient(135deg, var(--sweet2) 0%, var(--sweet3) 100%);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      overflow: hidden;
      padding: clamp(0.6rem, 2vw, 1rem) clamp(1.2rem, 4vw, 2rem);
      font-size: clamp(0.9rem, 2vw, 1.2rem);
      font-weight: bold;
      white-space: nowrap;
    }
    
    .envelope-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 50%;
      background: rgba(255, 255, 255, 0.1);
      transform: skewY(-5deg);
      transform-origin: right top;
    }
    
    .envelope-btn:hover {
      transform: translateX(-50%) translateY(-5px) !important;
      box-shadow: 0 15px 30px -5px rgba(244, 114, 182, 0.7), 0 10px 15px -6px rgba(192, 132, 252, 0.5);
    }
    
    /* å“åº”å¼å¸ƒå±€ */
    .w-full {
      width: 100%;
    }
    
    .h-screen {
      height: 100vh;
    }
    
    .relative {
      position: relative;
    }
    
    .absolute {
      position: absolute;
    }
    
    .inset-0 {
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
    }
    
    .flex {
      display: flex;
    }
    
    .items-center {
      align-items: center;
    }
    
    .justify-center {
      justify-content: center;
    }
    
    .hidden {
      display: none;
    }
    
    .z-0 { z-index: 0; }
    .z-10 { z-index: 10; }
    .z-20 { z-index: 20; }
    
    /* åŠ¨ç”»ç›¸å…³ */
    .transition-all {
      transition: all 0.3s ease;
    }
    
    /* å“åº”å¼è¾…åŠ© */
      @media (max-width: 768px) {
        .w-64 {
          width: 16rem;
    }
        
        .h-48 {
          height: 12rem;
        }
      }
      
      @media (min-width: 769px) {
        .md\:w-80 {
          width: 20rem;
        }
        
        .md\:h-64 {
          height: 16rem;
        }
      }
      
      /* è¡¥å……ç¼ºå¤±çš„å…³é”®æ ·å¼ */
      .transform {
        transform: var(--transform, none);
      }
      
      .-translate-x-1/2 {
        --transform: translateX(-50%);
      }
      
      .translate-x-1/2 {
        --transform: translateX(50%);
      }
      
      .scale-105 {
        transform: scale(1.05);
      }
      
      .scale-110 {
        transform: scale(1.1);
      }
      
      .scale-150 {
        transform: scale(1.5);
      }
      
      .mx-auto {
        margin-left: auto;
        margin-right: auto;
      }
      
      .px-4 {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      
      .py-2 {
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
      }
      
      .rounded-lg {
        border-radius: 0.5rem;
      }
      
      .rounded-full {
        border-radius: 9999px;
      }
      
      .text-white {
      color: white !important;
    }
      
      .text-pink-600 {
        color: #db2777;
      }
      
      .text-sm {
        font-size: 0.875rem;
      }
      
      .font-bold {
        font-weight: bold;
      }
      
      .shadow-lg {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      
      .shadow-md {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      
      .shadow-2xl {
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      }
      
      .backdrop-blur-sm {
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
      }
      
      .bg-white/80 {
        background-color: rgba(255, 255, 255, 0.8);
      }
      
      .bg-black/50 {
        background-color: rgba(0, 0, 0, 0.5);
      }
    
    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
    ::-webkit-scrollbar {
      display: none;
    }
    
    html {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    /* ç¡®ä¿æŒ‰é’®åœ¨åº•éƒ¨çš„ä½ç½® */
    .bottom-25vh {
      bottom: 25vh;
    }
  </style>
  
  <style>
        /* èƒ¶å·æ•ˆæœæ ·å¼ */
        .film-roll {
          position: relative;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, #5D4037 0%, #795548 50%, #5D4037 100%);
          border-radius: 15px;
          padding: 40px 20px;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        
        /* èƒ¶å·å­”æ´æ ·å¼ */
        .film-holes-top, .film-holes-bottom {
          position: absolute;
          left: 0;
          right: 0;
          height: 20px;
          display: flex;
          justify-content: space-around;
          align-items: center;
        }
        
        .film-holes-top {
          top: 10px;
        }
        
        .film-holes-bottom {
          bottom: 10px;
        }
        
        .film-hole {
          width: 20px;
          height: 20px;
          border-radius: 50%;
          background-color: #000;
          border: 2px solid #333;
        }
        
        /* èƒ¶å·è½¨é“æ ·å¼ */
        .film-track {
          position: relative;
          width: 100%;
          height: calc(100% - 40px);
          background: #1A1A1A;
          border: 2px solid #333;
          border-radius: 8px;
          overflow: hidden;
        }
        
        /* ç…§ç‰‡æ¡†æ¶æ ·å¼ - èƒ¶å·æ•ˆæœ */
        .photo-frame {
          flex: 0 0 100%;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          position: relative;
          background: #000;
        }
        
        .photo-frame img {
          max-width: 98%;
          max-height: 98%;
          object-fit: contain;
          border: 3px solid #fff;
          box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }
        
        /* æŒ‰é’®æ ·å¼ - è¦†ç›–å‰é¢çš„å®šä¹‰ */
        .btn-gradient {
          background: linear-gradient(135deg, #C084FC 0%, #F472B6 100%) !important;
          box-shadow: 0 10px 25px -5px rgba(244, 114, 182, 0.5), 0 8px 10px -6px rgba(192, 132, 252, 0.3) !important;
          transition: all 0.3s ease !important;
        }
        .btn-gradient:hover {
          box-shadow: 0 15px 30px -5px rgba(244, 114, 182, 0.7), 0 10px 15px -6px rgba(192, 132, 252, 0.5) !important;
          transform: translateY(-3px) !important;
        }
        
        /* å¼¹å¹•æ ·å¼ */
        .danmu {
          position: absolute;
          background: white;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          z-index: 10;
          opacity: 0;
          transform: scale(0);
          min-width: 180px;
          max-width: 80%;
        }
        
        .danmu-header {
          background: linear-gradient(135deg, #C084FC 0%, #F472B6 100%);
          padding: 0.3rem 0.8rem;
          border-radius: 8px 8px 0 0;
          display: flex;
          align-items: center;
          gap: 0.3rem;
        }
        
        .danmu-dot {
          width: 6px;
          height: 6px;
          border-radius: 50%;
          background: white;
        }
        
        .danmu-title {
          color: white;
          font-size: 0.8rem;
          font-weight: bold;
          flex: 1;
          text-align: center;
        }
        
        .danmu-content {
          padding: clamp(0.5rem, 2vw, 0.8rem) clamp(0.8rem, 3vw, 1.2rem);
          color: #333;
          font-family: 'Comic Sans MS', sans-serif;
          font-size: clamp(0.8rem, 2.5vw, 1rem);
          text-align: center;
          white-space: normal;
          word-wrap: break-word;
        }
        
        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes popIn {
          0% { opacity: 0; transform: scale(0); }
          70% { transform: scale(1.1); }
          100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes floatHeart {
          0% { transform: translateY(100vh) translateX(0) rotate(0deg) scale(1); opacity: 0; }
          20% { transform: translateY(calc(100vh - 30vh)) translateX(calc(var(--x-offset, 10px) * var(--direction, 1))) rotate(calc(var(--rotation, 30deg) * var(--direction, 1))) scale(var(--scale, 1.2)); opacity: 0.7; }
          50% { transform: translateY(calc(100vh - 60vh)) translateX(calc(var(--x-offset, 10px) * var(--direction, 1) * -0.5)) rotate(calc(var(--rotation, 30deg) * var(--direction, 1) * -1)) scale(var(--scale, 1.3)); opacity: 0.8; }
          80% { transform: translateY(calc(100vh - 90vh)) translateX(calc(var(--x-offset, 10px) * var(--direction, 1) * 0.3)) rotate(calc(var(--rotation, 30deg) * var(--direction, 1) * 0.5)) scale(var(--scale, 1.1)); opacity: 0.6; }
          100% { transform: translateY(-20vh) translateX(0) rotate(360deg) scale(0.8); opacity: 0; }
        }
        
        @keyframes floatAround {
          0% { transform: translate(0, 0) rotate(0deg); opacity: 0; }
          20% { transform: translate(20px, -10px) rotate(10deg); opacity: 0.7; }
          40% { transform: translate(0px, -20px) rotate(0deg); opacity: 0.8; }
          60% { transform: translate(-20px, -30px) rotate(-10deg); opacity: 0.7; }
          80% { transform: translate(0px, -40px) rotate(0deg); opacity: 0.5; }
          100% { transform: translate(0px, -50px) rotate(5deg); opacity: 0; }
        }
        
        @keyframes twinkle {
          0%, 100% { opacity: 0.3; transform: scale(0.8); }
          50% { opacity: 1; transform: scale(1.5); }
        }
        
        @keyframes riseBubble {
          0% { transform: translateY(100vh) scale(0.5); opacity: 0; }
          10% { opacity: 0.5; }
          90% { opacity: 0.5; }
          100% { transform: translateY(-20vh) scale(1.2); opacity: 0; }
        }
        
        @keyframes float3DHeart {
          0%, 100% {
            transform: translateY(0) translateX(0) rotate(0deg) scale(1);
            opacity: 0;
          }
          10%, 90% {
            opacity: 0.8;
          }
          25% {
            transform: translateY(-10vh) translateX(5vw) rotate(30deg) scale(1.2);
          }
          75% {
            transform: translateY(-7vh) translateX(-5vw) rotate(-30deg) scale(1.1);
          }
        }
        
        @keyframes heartbeat {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.5); }
        }
        
        @keyframes firework {
          0% {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
          100% {
            opacity: 0;
            transform: translateY(-100vh) scale(0.3);
          }
        }
        
        /* å…¶ä»–è¾…åŠ©æ ·å¼ */
        .big-danmu {
          font-size: clamp(1rem, 3.5vw, 1.6rem) !important;
          font-weight: bold;
          padding: clamp(0.6rem, 2.5vw, 0.9rem) clamp(1rem, 4vw, 1.8rem);
          z-index: 15;
        }
        
        .bg-heart {
          position: absolute;
          color: rgba(255, 255, 255, 0.6);
          font-size: clamp(0.375rem, 1.5vw, 1.125rem);
          animation: floatHeart calc(4s + var(--duration-offset, 0s)) var(--easing, ease-in-out) infinite;
          animation-delay: var(--delay, 0s);
          opacity: 0;
        }
        
        .bg-heart-float {
          position: absolute;
          opacity: 0;
          animation: floatAround 8s ease-in-out infinite;
        }
        
        .bg-star {
          position: absolute;
          background-color: rgba(255, 255, 255, 0.9);
          border-radius: 50%;
          width: 1px;
          height: 1px;
          box-shadow: 0 0 1px 0.5px rgba(255, 255, 255, 0.7);
          animation: twinkle 2.5s ease-in-out infinite;
        }
        
        .bg-bubble {
          position: absolute;
          border: 2px solid rgba(255, 255, 255, 0.5);
          border-radius: 50%;
          animation: riseBubble 8s linear infinite;
          opacity: 0;
        }
        
        .particle-heart {
          position: absolute;
          color: rgba(244, 114, 182, 0.8);
          font-size: clamp(0.5rem, 2vw, 1.5rem);
          transform-origin: center;
          animation: float3DHeart 8s ease-in-out 0s infinite;
          filter: drop-shadow(0 0 10px rgba(244, 114, 182, 0.7));
          opacity: 0.8;
        }
        
        /* é£˜åŠ¨å°çˆ±å¿ƒæ ·å¼ */
        .floating-heart {
          position: absolute;
          pointer-events: none;
          animation: floatUp ease-in-out infinite;
          text-shadow: 0 0 5px rgba(255, 105, 180, 0.5);
          transform-origin: center;
        }
        
        @keyframes floatUp {
          0% {
            transform: translateY(100vh) rotate(0deg) scale(0);
            opacity: 0;
          }
          10% {
            opacity: 0.8;
            transform: translateY(90vh) rotate(10deg) scale(0.8);
          }
          50% {
            transform: translateY(50vh) rotate(-10deg) scale(1);
            opacity: 0.9;
          }
          90% {
            opacity: 0.8;
            transform: translateY(10vh) rotate(5deg) scale(0.8);
          }
          100% {
            transform: translateY(-10vh) rotate(0deg) scale(0);
            opacity: 0;
          }
        }
        
        .heart-container {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          z-index: 1;
        }
        
        .heart-container img {
          width: clamp(200px, 65vw, 450px);
          height: auto;
          filter: drop-shadow(0 0 30px #ff69b4);
          animation: heartbeat 2s ease-in-out infinite;
        }
        
        .text-particle {
          position: absolute;
          pointer-events: none;
          opacity: 0;
          will-change: transform, opacity;
          font-family: 'Microsoft YaHei', sans-serif;
          font-weight: bold;
          z-index: 2;
        }
  </style>
</head>

<body class="bg-black min-h-screen overflow-hidden">
    <!-- éŸ³é¢‘æ’­æ”¾æç¤ºç•Œé¢ - åœ¨ç”¨æˆ·äº¤äº’å‰æ˜¾ç¤º -->
    <div id="audio-prompt" style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 99999;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
    ">
      <h1 style="font-size: 28px; margin-bottom: 30px; color: #ff6b6b;">ç‚¹å‡»å¼€å§‹</h1>
      <p style="font-size: 18px; margin-bottom: 50px; max-width: 80%;">è¯·è¿™ä¸ªä¸–ç•Œæœ€å¯çˆ±æœ€æ¼‚äº®çš„å´½å´½ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œæ¬£èµè¿™ä»½ç‰¹åˆ«çš„ç¤¼ç‰©</p>
      <button id="start-audio-btn" style="
        padding: 15px 40px;
        font-size: 20px;
        background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        transition: all 0.3s ease;
        outline: none;
      ">å¼€å§‹æ’­æ”¾</button>
    </div>
  <div id="start" class="w-full h-screen relative p-4 overflow-hidden bg-black">
    <!-- æ˜Ÿæ˜ŸèƒŒæ™¯å®¹å™¨ -->
    <div id="stars-container" class="absolute inset-0 z-0"></div>
    
    <!-- ç²’å­èƒŒæ™¯å®¹å™¨ -->
    <div id="particle-container" class="absolute inset-0 z-0"></div>
    
    <!-- ä¸­å¤®çˆ±å¿ƒæ•ˆæœ - æ·»åŠ é”™è¯¯å¤„ç† -->
      <div id="center-heart" class="heart-container" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1;">
        <img src="https://pic.imgdb.cn/item/642547f5a682492fcc15cd5d.gif" alt="çˆ±å¿ƒ" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSIjZmY2OWI0IiBmaWxsLW9wYWNpdHk9IjAuOSIgZD0iTTUyIDM1IEMzOCAzNSAzMCA0MyAyNiA1NS41QzIyIDQzIDE0IDM1IDAgMzUgQzAgMzUgMTcgNDcgMjUgNjJDMzMgNzcgNDYgOTIgNTIgOTJDNTggOTIgNzEgNzcgNzkgNjJDODcgNDcgNzMgMzUgNTIgMzVaIj48L3BhdGg+PC9zdmc+';" style="animation: heartbeat 1.2s ease-in-out infinite;" />
      </div>
    
    <!-- æŒ‰é’®ä½ç½®è°ƒæ•´åˆ°çˆ±å¿ƒçš„æ­£ä¸‹æ–¹ï¼Œå±…ä¸­æ˜¾ç¤º -->
    <button id="open" style="position: absolute; top: 70%; left: 50%; transform: translateX(-50%); z-index: 20;" 
      class="envelope-btn text-white 
      text-[clamp(0.75rem,2.5vw,1.1rem)] 
      px-[clamp(1.5rem,6vw,3rem)] 
      py-[clamp(0.8rem,3vw,1.5rem)] 
      font-cute">
      è¯·æˆ‘çš„æš„æš„å°æœ‹å‹æ¥å—ç¤¼ç‰©
    </button>
    
    <!-- éŸ³é¢‘åŠŸèƒ½å°†åœ¨JavaScriptä¸­é€šè¿‡åŠ¨æ€åˆ›å»ºå®ç°ï¼Œé¿å…æ–‡ä»¶åŠ è½½é”™è¯¯ -->
    
    <!-- é•¿æŒ‰æç¤ºæ¡† -->
    <div id="heartTip" class="absolute top-1/3 left-1/2 -translate-x-1/2 bg-white/80 backdrop-blur-sm px-4 py-2 rounded-lg text-pink-600 font-cute text-sm hidden z-20 shadow-lg">
      é•¿æŒ‰çˆ±å¿ƒæ’­æ”¾éŸ³ä¹ â¤ï¸
    </div>
  </div>
  
  <div id="main" class="w-full h-screen 
    bg-gradient-to-br from-sweet2/90 to-sweet1/90 
    hidden relative overflow-hidden">
      <div id="bg-decor" class="absolute inset-0"></div>
      <div id="danmu-container" class="absolute inset-0"></div>
      
      <!-- ç…§ç‰‡æ»‘åŠ¨å±•ç¤ºåŒºåŸŸ -->
      <div id="photo-gallery" class="absolute inset-0 flex items-center justify-center px-0">
        <div id="photo-container" class="relative w-full h-[70vh] min-h-[450px] overflow-hidden">
          <div id="photo-slider" class="flex transition-transform duration-300 h-full">
          <!-- ç…§ç‰‡å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
        </div>
        <!-- å·¦å³ç•Œé™æŒ‡ç¤ºå™¨ -->
        <div id="left-bound" class="absolute left-0 top-0 bottom-0 w-1 bg-red-500 z-10 hidden"></div>
        <div id="right-bound" class="absolute right-0 top-0 bottom-0 w-1 bg-red-500 z-10 hidden"></div>
        <!-- æç¤ºä¿¡æ¯ -->
        <div id="swipe-hint" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black/50 text-white px-4 py-2 rounded-lg text-sm z-20">
          å·¦å³æ»‘åŠ¨æŸ¥çœ‹ç…§ç‰‡
        </div>
      </div>
    </div>
  </div>

  <script>
    // è®¾å¤‡æ€§èƒ½æ£€æµ‹å’Œç¯å¢ƒæ£€æµ‹
    let isLowEndDevice = false;
    let isWechatBrowser = false;
    
    // æ£€æµ‹å¾®ä¿¡æµè§ˆå™¨
    function detectWechatBrowser() {
      const ua = navigator.userAgent.toLowerCase();
      isWechatBrowser = ua.includes('micromessenger');
      console.log('å¾®ä¿¡æµè§ˆå™¨:', isWechatBrowser);
      return isWechatBrowser;
    }
    
    // æ£€æµ‹è®¾å¤‡æ€§èƒ½ï¼Œä½ç«¯è®¾å¤‡é™ä½åŠ¨ç”»å¤æ‚åº¦
      function checkDevicePerformance() {
        // æ£€æµ‹å†…å­˜å’ŒCPU
        const memory = navigator.deviceMemory || 4;
        const cores = navigator.hardwareConcurrency || 4;
        const isMobile = window.innerWidth < 768;
        const isSlowMobile = isMobile && (memory < 3 || cores < 4);
        
        // æ›´ä¸¥æ ¼åœ°è¯†åˆ«ä½ç«¯è®¾å¤‡ï¼Œç‰¹åˆ«æ˜¯å¾®ä¿¡æµè§ˆå™¨
        isLowEndDevice = isSlowMobile || 
                       (performance && performance.memory && performance.memory.jsHeapSizeLimit < 1073741824) ||
                       isWechatBrowser || // å¾®ä¿¡æµè§ˆå™¨é»˜è®¤è§†ä¸ºä¸­ä½ç«¯è®¾å¤‡ä»¥ç¡®ä¿æµç•…æ€§
                       (isMobile && window.innerWidth < 480); // å°å±å¹•æ‰‹æœºç›´æ¥è§†ä¸ºä½ç«¯è®¾å¤‡
      
      if (isLowEndDevice) {
        console.log('æ£€æµ‹åˆ°ä½ç«¯è®¾å¤‡æˆ–å¾®ä¿¡æµè§ˆå™¨ï¼Œé™ä½åŠ¨ç”»å¤æ‚åº¦');
      }
    }
    
    // ä¼˜åŒ–æ£€æµ‹å‡½æ•°æ‰§è¡Œæ—¶æœº
    detectWechatBrowser();
    
    // å»¶è¿Ÿæ‰§è¡Œæ€§èƒ½æ£€æµ‹ï¼Œé¿å…é˜»å¡ä¸»æ¸²æŸ“çº¿ç¨‹
    setTimeout(checkDevicePerformance, 0);
    
    // æ·»åŠ é˜²æŠ–å’ŒèŠ‚æµå‡½æ•°ç”¨äºä¼˜åŒ–äº‹ä»¶å¤„ç†
    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }
    
    function throttle(func, limit) {
      let inThrottle;
      return function(...args) {
        if (!inThrottle) {
          func.apply(this, args);
          inThrottle = true;
          setTimeout(() => inThrottle = false, limit);
        }
      };
    }
    
    const texts = [
      "æš„æš„è€å©†ä¸‡åœ£èŠ‚å¿«ä¹",
      "è€å©†å¥–åŠ±æˆ‘ä¸€ä¸ªäº²äº²",
      "è€å©†è¾›è‹¦å•¦æ—©ç‚¹ä¼‘æ¯",
      "è€å©†ä½ è¿˜æœ‰æˆ‘å‘¢ä¸è¦å†ä¼¤å®³è‡ªå·±äº†",
      "è€å©†æˆ‘ä»¬é©¬ä¸Šå°±è¦è§é¢å•¦",
      "ç¥è€å©†å­¦ä¸šé¡ºåˆ©",
      "æš„æš„è€å©†å†¬è‡³å¿«ä¹"
    ];
    
    const colors = [
      '#87CEEB', '#B0E2FF', '#87CEFA', '#82CAFF', 
      '#7EC0EE', '#BFEFFF', '#ADD8E6', '#98D8C8'
    ];
    
    let danmuTimer = null; // å¼¹å¹•å¾ªç¯å®šæ—¶å™¨ï¼Œç”¨äºåç»­æ¸…é™¤
    
    // å·²ç§»é™¤é£˜åŠ¨çš„å°çˆ±å¿ƒèƒŒæ™¯åŠŸèƒ½
    /*
    function createFloatingHearts() {
      // æ­¤åŠŸèƒ½å·²ç§»é™¤ï¼Œä¸å†æ˜¾ç¤ºåº•éƒ¨é£˜ä¸Šæ¥çš„çˆ±å¿ƒæ•ˆæœ
    }
    */
    
    window.onload = () => {
      init();
      // ç§»é™¤äº†createFloatingHearts()è°ƒç”¨ï¼Œä¸å†æ˜¾ç¤ºåº•éƒ¨é£˜ä¸Šæ¥çš„çˆ±å¿ƒæ•ˆæœ
      
      // ç‚¹æŒ‰çˆ±å¿ƒäº¤äº’åŠŸèƒ½
      const heartContainer = document.getElementById('center-heart');
      const heartTip = document.getElementById('heartTip');
      
      // æ›´æ–°æç¤ºæ¡†æ–‡æœ¬ä¸ºæ›´é€šç”¨çš„äº¤äº’æç¤º
      if (heartTip) {
        heartTip.textContent = 'ç‚¹å‡»çˆ±å¿ƒäº’åŠ¨ â¤ï¸';
      }
      
      // æ˜¾ç¤ºæç¤ºæ¡†
      heartContainer.addEventListener('mouseenter', () => {
        if (heartTip) {
          heartTip.classList.remove('hidden');
        }
      });
      
      // éšè—æç¤ºæ¡†
      heartContainer.addEventListener('mouseleave', () => {
        if (heartTip) {
          heartTip.classList.add('hidden');
        }
      });
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶ - æ¢å¤éŸ³é¢‘æ’­æ”¾åŠŸèƒ½
      const handleHeartClick = () => {
        // æ·»åŠ è§†è§‰åé¦ˆæ•ˆæœ - ä¼˜åŒ–ç‚¹å‡»åé¦ˆï¼Œé¿å…åŠ¨ç”»å†²çª
        if (heartContainer) {
          // è·å–å†…éƒ¨çš„çˆ±å¿ƒå›¾ç‰‡å…ƒç´ 
          const heartImg = heartContainer.querySelector('img');
          if (heartImg) {
            // ä¿å­˜åŸå§‹åŠ¨ç”»
            const originalAnimation = heartImg.style.animation;
            
            // ä¸´æ—¶æ›¿æ¢ä¸ºæ›´å¿«é€Ÿçš„å¿ƒè·³åŠ¨ç”»
            heartImg.style.animation = 'heartbeat 0.2s ease-in-out';
            
            // ç§»é™¤transform-originçš„å½±å“
            heartImg.style.transformOrigin = 'center';
            
            setTimeout(() => {
              if (heartImg) {
                // æ¢å¤åŸå§‹åŠ¨ç”»
                heartImg.style.animation = originalAnimation;
              }
            }, 200);
          }
        }
        
        // ç®€åŒ–çš„éŸ³ä¹æ’­æ”¾å¤„ç†
        try {
          // åœæ­¢å…¶ä»–éŸ³ä¹
          if (music2) {
            music2.pause();
            music2.currentTime = 0;
          }
          
          // æ’­æ”¾5å·éŸ³ä¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
          if (music5) {
            // é‡ç½®æ’­æ”¾ä½ç½®
            music5.currentTime = 0;
            
            // å°è¯•æ’­æ”¾ - ä½¿ç”¨try/catchå¤„ç†æ‰€æœ‰å¯èƒ½çš„é”™è¯¯
            try {
              // ç®€å•ç›´æ¥çš„æ’­æ”¾æ–¹å¼
              music5.play();
              console.log('5å·éŸ³ä¹æ’­æ”¾å°è¯•å·²å‘é€');
            } catch (playErr) {
              console.warn('æ’­æ”¾éœ€è¦ç”¨æˆ·äº¤äº’:', playErr.message);
              // é™é»˜å¤„ç†é”™è¯¯ï¼Œé¿å…å¹²æ‰°ç”¨æˆ·ä½“éªŒ
            }
          }
        } catch (e) {
          // æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œç¡®ä¿ç•Œé¢åŠŸèƒ½æ­£å¸¸
          console.error('éŸ³ä¹æ“ä½œé”™è¯¯:', e);
        }
        
        // æ˜¾ç¤ºéšæœºå¼¹å¹•
        showRandomDanmu();
        
        // å§‹ç»ˆæ˜¾ç¤ºå‹å¥½çš„äº¤äº’æç¤º
        if (heartTip) {
          heartTip.textContent = 'â¤ï¸ çˆ±ä½ å“¦ â¤ï¸';
          setTimeout(() => {
            if (heartTip) heartTip.textContent = 'ç‚¹å‡»çˆ±å¿ƒäº’åŠ¨ â¤ï¸';
          }, 1500);
        }
      };
      
      // æ˜¾ç¤ºéšæœºå¼¹å¹•çš„å‡½æ•° - ä½¿ç”¨å’ŒæŒ‰é’®ç‚¹å‡»åç›¸åŒçš„å¼¹å¹•ç±»å‹
      function showRandomDanmu() {
        // ç¡®ä¿æœ‰å¼¹å¹•å®¹å™¨
        let danmuContainer = document.getElementById('danmu-container');
        if (!danmuContainer) {
          // å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ª
          danmuContainer = document.createElement('div');
          danmuContainer.id = 'danmu-container';
          danmuContainer.style.position = 'fixed';
          danmuContainer.style.top = '0';
          danmuContainer.style.left = '0';
          danmuContainer.style.width = '100%';
          danmuContainer.style.height = '100%';
          danmuContainer.style.pointerEvents = 'none';
          danmuContainer.style.zIndex = '10000'; // æé«˜z-indexç¡®ä¿ä¸è¢«ä»»ä½•å…ƒç´ é®æŒ¡
          // å°†å¼¹å¹•å®¹å™¨æ·»åŠ åˆ°bodyçš„æœ€å‰é¢ï¼Œç¡®ä¿æ˜¾ç¤ºå±‚çº§æœ€é«˜
          if (document.body.firstChild) {
            document.body.insertBefore(danmuContainer, document.body.firstChild);
          } else {
            document.body.appendChild(danmuContainer);
          }
        }
        
        // éšæœºå¼¹å¹•å†…å®¹æ•°ç»„
        const danmuTexts = [
          'ï¼ï¼ï¼å°å‚»ç“œ',
          'æš„æš„è€å©†äº²æˆ‘ä¸€å£',
          'è€å©†æˆ‘è¦æŠ±æŠ±'
        ];
        
        // éšæœºé€‰æ‹©ä¸€ä¸ªå¼¹å¹•å†…å®¹
        const randomText = danmuTexts[Math.floor(Math.random() * danmuTexts.length)];
        
        // åˆ›å»ºå¼¹å¹•å…ƒç´ ï¼Œä½¿ç”¨å’ŒæŒ‰é’®ç‚¹å‡»åç›¸åŒçš„å¼¹å¹•æ ·å¼
        const danmu = document.createElement('div');
        danmu.className = 'danmu'; // ä½¿ç”¨ç°æœ‰çš„danmuæ ·å¼ç±»
        
        // è®¾ç½®æ ·å¼ï¼Œæ˜¾ç¤ºåœ¨æ›´æ˜æ˜¾çš„ä½ç½®
        danmu.style.position = 'fixed';
        danmu.style.left = '50%';
        danmu.style.top = '20%'; // è°ƒæ•´ä½ç½®åˆ°æ›´æ˜æ˜¾çš„åœ°æ–¹
        danmu.style.transform = 'translate(-50%, 0)';
        danmu.style.opacity = '0';
        danmu.style.zIndex = '10000'; // æé«˜z-indexç¡®ä¿ä¸è¢«é®æŒ¡
        danmu.style.borderRadius = '20px';
        danmu.style.boxShadow = '0 8px 32px rgba(255, 105, 180, 0.5)'; // å¢åŠ é˜´å½±å¼ºåº¦
        danmu.style.background = 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(255,255,255,0.95))'; // å¢åŠ ä¸é€æ˜åº¦
        danmu.style.padding = '16px 28px'; // å¢åŠ å†…è¾¹è·
        danmu.style.fontFamily = 'Arial, sans-serif';
        danmu.style.fontSize = '24px'; // å¢å¤§å­—ä½“å¤§å°
        danmu.style.fontWeight = 'bold';
        danmu.style.textAlign = 'center';
        danmu.style.color = '#ff4d6d';
        danmu.style.letterSpacing = '1.5px'; // å¢åŠ å­—é—´è·
        danmu.style.border = '2px solid rgba(255, 77, 109, 0.3)'; // æ·»åŠ è¾¹æ¡†ä»¥å¢å¼ºå¯è§æ€§
        
        // è®¾ç½®å¼¹å¹•æ–‡æœ¬å†…å®¹
        danmu.textContent = randomText;
        
        // æ·»åŠ åˆ°å®¹å™¨çš„æœ€å‰é¢ï¼Œç¡®ä¿æ˜¾ç¤ºåœ¨æœ€ä¸Šæ–¹
        danmuContainer.insertBefore(danmu, danmuContainer.firstChild);
        
        // åŠ¨ç”»æ•ˆæœï¼šä»ä¸Šæ–¹æ»‘å…¥ï¼Œç„¶åæ·¡å‡ºï¼Œæ—¶é—´å»¶é•¿ä»¥ç¡®ä¿æœ‰è¶³å¤Ÿæ—¶é—´çœ‹åˆ°
        setTimeout(() => {
          // å¼ºåˆ¶é‡ç»˜
          void danmu.offsetWidth;
          
          // å…¥åœºåŠ¨ç”» - å‡æ…¢é€Ÿåº¦ï¼Œè®©æ•ˆæœæ›´æ˜æ˜¾
          danmu.style.transition = 'all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
          danmu.style.opacity = '1';
          danmu.style.transform = 'translate(-50%, 0) translateY(15px)';
          
          // åœç•™æ›´é•¿æ—¶é—´
          setTimeout(() => {
            // æ·¡å‡ºåŠ¨ç”»
            danmu.style.transition = 'all 1.2s ease-out';
            danmu.style.opacity = '0';
            danmu.style.transform = 'translate(-50%, 0) translateY(-25px)';
            
            // ç§»é™¤å¼¹å¹•
            setTimeout(() => {
              if (danmuContainer && danmuContainer.contains(danmu)) {
                danmuContainer.removeChild(danmu);
              }
            }, 1200);
          }, 2500); // å¢åŠ åœç•™æ—¶é—´åˆ°2.5ç§’
        }, 10);
      }
      
      // é¼ æ ‡ç‚¹å‡»äº‹ä»¶
      heartContainer.addEventListener('click', handleHeartClick);
      
      // è§¦æ‘¸ç‚¹å‡»äº‹ä»¶ - ä¼˜åŒ–å¾®ä¿¡æµè§ˆå™¨å…¼å®¹æ€§
      heartContainer.addEventListener('touchstart', (e) => {
        // å¾®ä¿¡æµè§ˆå™¨ä¸é˜»æ­¢é»˜è®¤äº‹ä»¶ï¼Œå…è®¸æ­£å¸¸äº¤äº’
        if (!isWechatBrowser) {
          e.preventDefault();
        }
        handleHeartClick();
      }, { passive: isWechatBrowser }); // å¾®ä¿¡æµè§ˆå™¨ä½¿ç”¨passiveæ¨¡å¼æé«˜æ€§èƒ½
      
      // å¼€å§‹æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      document.getElementById('open').addEventListener('click', () => {
      // 1. é¦–å…ˆæ˜¾ç¤ºå¼¹å¹•ï¼Œç¡®ä¿åœ¨é¡µé¢åˆ‡æ¢å‰æ˜¾ç¤º
      // è·å–æŒ‰é’®ä½ç½®ä½œä¸ºå¼¹å¹•çˆ†ç‚¸ä¸­å¿ƒç‚¹
      const button = document.getElementById('open');
      const rect = button.getBoundingClientRect();
      const clickX = rect.left + rect.width / 2;
      const clickY = rect.top + rect.height / 2;
      
      // ç«‹å³æ˜¾ç¤ºéšæœºå¼¹å¹•
      showRandomDanmu();
      // åŒæ—¶åœ¨æŒ‰é’®ä½ç½®æ˜¾ç¤ºçˆ†ç‚¸å¼¹å¹•
      explodeDanmuAtPosition(clickX, clickY);
      
      // 2. å»¶è¿Ÿé¡µé¢åˆ‡æ¢ï¼Œç¡®ä¿å¼¹å¹•æœ‰è¶³å¤Ÿæ—¶é—´æ˜¾ç¤º
      setTimeout(() => {
        document.getElementById('start').classList.add('hidden');
        const mainPage = document.getElementById('main');
        mainPage.classList.remove('hidden');
        
        // ç¡®ä¿mainé¡µé¢æœ‰èƒŒæ™¯è‰²
        mainPage.style.background = 'linear-gradient(135deg, #F9A8D4 0%, #C084FC 100%)';
        
        // ä½¿ç”¨å¢å¼ºçš„èƒŒæ™¯æ•ˆæœï¼Œç¡®ä¿ä¸å¼€å§‹é¡µé¢ä¸€è‡´
        setTimeout(() => {
          createSweetBg();
        }, 100);
        
        // ä½¿ç”¨é˜²é”™å¤„ç†åˆå§‹åŒ–ç…§ç‰‡ç”»å»Š
        try {
          initPhotoGallery(); 
        } catch (error) {
          console.log('ç…§ç‰‡ç”»å»Šåˆå§‹åŒ–å¤±è´¥:', error);
        }
        
        // ä¼˜åŒ–æ’­æ”¾2å·éŸ³ä¹çš„é€»è¾‘ï¼Œç¡®ä¿åœ¨ç”¨æˆ·äº¤äº’ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ
        try {
          // åœæ­¢å…¶ä»–éŸ³ä¹
          if (music5) {
            music5.pause();
            music5.currentTime = 0;
          }
          
          // æ’­æ”¾2å·éŸ³ä¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰- ç›´æ¥åœ¨ç”¨æˆ·ç‚¹å‡»äº‹ä»¶ä¸­å°è¯•æ’­æ”¾
          if (music2) {
            // é‡ç½®æ’­æ”¾ä½ç½®
            music2.currentTime = 0;
            
            // å°è¯•æ’­æ”¾éŸ³ä¹ - ç›´æ¥åœ¨ç‚¹å‡»äº‹ä»¶å›è°ƒä¸­æ‰§è¡Œ
            music2.play().then(() => {
              console.log('2å·éŸ³ä¹æ’­æ”¾æˆåŠŸ');
              
              // æ˜¾ç¤ºéŸ³ä¹æ’­æ”¾æç¤º
              const musicTip = document.createElement('div');
              musicTip.textContent = 'ğŸµ èƒŒæ™¯éŸ³ä¹æ’­æ”¾ä¸­';
              musicTip.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(0, 0, 0, 0.7);
                color: white;
                padding: 10px 15px;
                border-radius: 20px;
                font-size: 14px;
                z-index: 10000; /* æé«˜z-indexç¡®ä¿ä¸è¢«é®æŒ¡ */
                animation: fadeInOut 3s ease-in-out;
              `;
              document.body.appendChild(musicTip);
              
              setTimeout(() => {
                if (document.body.contains(musicTip)) {
                  musicTip.style.opacity = '0';
                  setTimeout(() => {
                    if (document.body.contains(musicTip)) {
                      document.body.removeChild(musicTip);
                    }
                  }, 500);
                }
              }, 2500);
            }).catch(playErr => {
              console.warn('æ’­æ”¾èƒŒæ™¯éŸ³ä¹éœ€è¦ç”¨æˆ·äº¤äº’ï¼Œæ·»åŠ å¤‡ç”¨æ’­æ”¾æŒ‰é’®:', playErr.message);
              
              // æ·»åŠ å¤‡ç”¨æ’­æ”¾æŒ‰é’®
              const playMusicBtn = document.createElement('button');
              playMusicBtn.textContent = 'ğŸµ ç‚¹å‡»æ’­æ”¾èƒŒæ™¯éŸ³ä¹';
              playMusicBtn.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                padding: 12px 24px;
                background: linear-gradient(135deg, #ff6b6b, #ff5252);
                color: white;
                border: none;
                border-radius: 30px;
                box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
                font-size: 16px;
                cursor: pointer;
                z-index: 10000; /* æé«˜z-indexç¡®ä¿ä¸è¢«é®æŒ¡ */
                transition: all 0.3s ease;
                font-weight: bold;
                min-width: 200px;
              `;
              
              playMusicBtn.addEventListener('mouseover', () => {
                playMusicBtn.style.transform = 'translate(-50%, -50%) scale(1.05)';
                playMusicBtn.style.boxShadow = '0 8px 25px rgba(255, 107, 107, 0.5)';
              });
              
              playMusicBtn.addEventListener('mouseout', () => {
                playMusicBtn.style.transform = 'translate(-50%, -50%) scale(1)';
                playMusicBtn.style.boxShadow = '0 6px 20px rgba(255, 107, 107, 0.4)';
              });
              
              playMusicBtn.addEventListener('click', function() {
                music2.currentTime = 0;
                music2.play().then(() => {
                  console.log('å¤‡ç”¨æŒ‰é’®ç‚¹å‡»åï¼Œ2å·éŸ³ä¹æ’­æ”¾æˆåŠŸ');
                  // æ’­æ”¾æˆåŠŸåç§»é™¤æŒ‰é’®
                  this.style.transition = 'opacity 0.5s, transform 0.5s';
                  this.style.opacity = '0';
                  this.style.transform = 'translate(-50%, -50%) scale(0.8)';
                  setTimeout(() => {
                    if (document.body.contains(this)) {
                      document.body.removeChild(this);
                    }
                  }, 500);
                }).catch(e => {
                  console.error('å¤‡ç”¨æŒ‰é’®ä¹Ÿæ— æ³•æ’­æ”¾éŸ³ä¹:', e);
                  alert('æŠ±æ­‰ï¼Œæ— æ³•æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®');
                });
              });
              
              document.body.appendChild(playMusicBtn);
            });
          }
        } catch (e) {
          // æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œç¡®ä¿é¡µé¢åŠŸèƒ½æ­£å¸¸
          console.error('éŸ³ä¹æ“ä½œé”™è¯¯:', e);
        }
        
        console.log('åˆ‡æ¢åˆ°ä¸»é¡µé¢ï¼ŒèƒŒæ™¯éŸ³ä¹è®¾ç½®å®Œæˆ');
        
        // æ·»åŠ æ•´ä¸ªé¡µé¢çš„ç‚¹å‡»å¼¹å¹•äº‹ä»¶
        const addGlobalDanmuEvent = () => {
          document.addEventListener('click', handleGlobalClick);
        };
        
        const handleGlobalClick = (e) => {
          // è·å–ç‚¹å‡»ä½ç½®ï¼ˆç›¸å¯¹äºè§†å£ï¼‰
          const clickX = e.clientX;
          const clickY = e.clientY;
          // çˆ†ç‚¸å‡ºå¼¹å¹•
          explodeDanmuAtPosition(clickX, clickY);
        };
        
        // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶
        addGlobalDanmuEvent();
      }, 300); // å»¶è¿Ÿ300mså†åˆ‡æ¢é¡µé¢ï¼Œç¡®ä¿å¼¹å¹•æ˜¾ç¤º
    });
      
      // é¡µé¢åˆ‡æ¢å›å¼€å§‹é¡µæ—¶ï¼Œæ¸…é™¤å®šæ—¶å™¨ï¼ˆé¿å…åå°ç”Ÿæˆï¼‰
      window.addEventListener('visibilitychange', () => {
        if (document.hidden && danmuTimer) {
          clearInterval(danmuTimer);
          danmuTimer = null;
        } else if (!document.hidden && !danmuTimer && !document.getElementById('main').classList.contains('hidden')) {
        // é¡µé¢å¯è§æ—¶ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å¼¹å¹•å¾ªç¯é€»è¾‘
      }
      });
    };
    
    // FireworkSystemç±» - å®ç°æ–‡å­—ç²’å­å‘å°„æ•ˆæœ
    class FireworkSystem {
      constructor() {
        this.particles = [];
        this.texts = ['æˆ‘çˆ±ä½  æš„æš„', 'è¯·æˆ‘çš„æš„æš„å°æœ‹å‹æ¥å—ç¤¼ç‰©', 'æˆ‘æ°¸è¿œçˆ±ä½ ', 'ä½ æ˜¯æˆ‘çš„å”¯ä¸€'];
        this.colors = ['#00BFFF', '#4169E1', '#1E90FF', '#00CED1', '#FF69B4', '#FF1493'];
        this.init();
      }

      init() {
        // æ ¹æ®è®¾å¤‡æ€§èƒ½è°ƒæ•´ç²’å­æ± å¤§å°
        const poolSize = isLowEndDevice ? 100 : 200;
        this.createPool(poolSize);
        this.startLaunch();
        this.setupClick();
      }

      createPool(size) {
        const container = document.createElement('div');
        for (let i = 0; i < size; i++) {
          const p = document.createElement('div');
          p.className = 'text-particle';
          p.style.display = 'none';
          container.appendChild(p);
        }
        document.body.appendChild(container);
        this.pool = [...container.children];
      }

      getParticle() {
        return this.pool.find(p => p.style.display === 'none');
      }

      launch() {
        const particle = this.getParticle();
        if (!particle) return;

        // ç²’å­æ ·å¼è®¾ç½®
        particle.textContent = this.texts[Math.floor(Math.random() * this.texts.length)];
        particle.style.color = this.colors[Math.floor(Math.random() * this.colors.length)];
        // æ ¹æ®è®¾å¤‡æ€§èƒ½è°ƒæ•´å­—ä½“å¤§å°ï¼Œå‡å°‘æ¸²æŸ“è´Ÿæ‹…
        const fontSize = isLowEndDevice ? `${14 + Math.random() * 8}px` : `${18 + Math.random() * 12}px`;
        particle.style.fontSize = fontSize;
        particle.style.display = 'block';
        particle.style.opacity = '1';

        // åŠ¨ç”»å‚æ•°
        const startX = window.innerWidth * 0.5;
        const startY = window.innerHeight + 50;
        const angle = (Math.PI/2) + (Math.random() - 0.5) * Math.PI/2;
        // ä½ç«¯è®¾å¤‡ç¼©çŸ­è·ç¦»ï¼Œå‡å°‘è®¡ç®—é‡
        const distance = isLowEndDevice ? 300 + Math.random() * 200 : 500 + Math.random() * 300;
        // ä½ç«¯è®¾å¤‡åŠ å¿«åŠ¨ç”»é€Ÿåº¦
        const duration = isLowEndDevice ? 2 + Math.random() * 1.5 : 3 + Math.random() * 2;

        // è®¾ç½®åˆå§‹ä½ç½®
        particle.style.transform = `translate(${startX}px, ${startY}px)`;

        // åˆ›å»ºåŠ¨ç”»
        const animation = particle.animate([
          { 
            transform: `translate(${startX}px, ${startY}px) scale(1)`,
            opacity: 1
          },
          {
            transform: `translate(${startX + Math.cos(angle) * distance}px, 
                       ${startY - Math.abs(Math.sin(angle) * distance * 1.5)}px) scale(0.5)`,
            opacity: 0
          }
        ], {
          duration: duration * 1000,
          easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
        });

        animation.onfinish = () => {
          particle.style.display = 'none';
        };
      }

      startLaunch() {
        // æ§åˆ¶å‘å°„é¢‘ç‡ï¼Œé¿å…ä½ç«¯è®¾å¤‡æ€§èƒ½é—®é¢˜
        const interval = isLowEndDevice ? 200 : 100;
        let lastLaunchTime = 0;
        
        const launch = (timestamp) => {
          if (!lastLaunchTime || timestamp - lastLaunchTime > interval) {
            this.launch();
            lastLaunchTime = timestamp;
          }
          requestAnimationFrame(launch);
        };
        requestAnimationFrame(launch);
      }

      setupClick() {
        let lastClick = 0;
        document.addEventListener('click', (e) => {
          const now = Date.now();
          if (now - lastClick > 200) {
            // æ ¹æ®è®¾å¤‡æ€§èƒ½è°ƒæ•´ç‚¹å‡»æ—¶å‘å°„çš„ç²’å­æ•°é‡
            const particleCount = isLowEndDevice ? 15 : 30;
            for (let i = 0; i < particleCount; i++) {
              setTimeout(() => this.launch(), i * 50);
            }
            lastClick = now;
          }
        });
      }
    }
    
    function createStartDecor() {
      // åˆ›å»ºæ˜Ÿæ˜ŸèƒŒæ™¯
      createStarsBackground();
      // åˆ›å»ºç«‹ä½“çˆ±å¿ƒç²’å­èƒŒæ™¯
      createParticleHearts();
    }
    
    function createStarsBackground() {
      const container = document.getElementById('stars-container');
      // æ ¹æ®è®¾å¤‡æ€§èƒ½è°ƒæ•´æ˜Ÿæ˜Ÿæ•°é‡
      let starCount = window.innerWidth < 768 ? 200 : 400; // è°ƒæ•´é»˜è®¤æ•°é‡
      if (isLowEndDevice) {
        starCount = window.innerWidth < 768 ? 80 : 150; // ä½ç«¯è®¾å¤‡å‡å°‘æ˜Ÿæ˜Ÿæ•°ä»¥æé«˜æ€§èƒ½
      }
      
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('i');
        
        // éšæœºå¤§å°
        const size = Math.random() * 2 + 1;
        
        // éšæœºä½ç½®
        const left = Math.random() * 100;
        const top = Math.random() * 100;
        
        // éšæœºåŠ¨ç”»å»¶è¿Ÿ
        const delay = Math.random() * 3;
        
        // éšæœºä¸é€æ˜åº¦
        const opacity = Math.random() * 0.8 + 0.2;
        
        // è®¾ç½®æ ·å¼
        star.className = 'bg-star';
        star.style.width = `${size * 0.5}px`;
        star.style.height = `${size * 0.5}px`;
        star.style.left = `${left}%`;
        star.style.top = `${top}%`;
        star.style.opacity = opacity;
        star.style.animation = `twinkle ${Math.random() * 2 + 1}s ease-in-out ${delay}s infinite`;
        
        container.appendChild(star);
      }
    }
    
    function createParticleHearts() {
      const container = document.getElementById('particle-container');
      // æ ¹æ®è®¾å¤‡æ€§èƒ½è°ƒæ•´ç²’å­æ•°é‡
      let count = window.innerWidth < 768 ? 150 : 250; // è°ƒæ•´é»˜è®¤æ•°é‡
      if (isLowEndDevice) {
        count = window.innerWidth < 768 ? 80 : 120; // ä½ç«¯è®¾å¤‡å‡å°‘ç²’å­æ•°ä»¥æé«˜æ€§èƒ½
      }
      
      const heartClasses = ['bg-heart', 'particle-heart'];
      const easings = ['ease-in-out', 'ease-in', 'ease-out', 'cubic-bezier(0.34, 1.56, 0.64, 1)', 'cubic-bezier(0.68, -0.55, 0.265, 1.55)'];
      
      for (let i = 0; i < count; i++) {
        const heart = document.createElement('div');
        heart.innerHTML = 'â¤';
        
        // éšæœºé€‰æ‹©ç±»åï¼Œæ··åˆä½¿ç”¨ä¸åŒçš„åŠ¨ç”»
        const randomClass = heartClasses[Math.floor(Math.random() * heartClasses.length)];
        heart.className = randomClass;
        
        // éšæœºä½ç½®
        heart.style.left = `${Math.random() * 100}%`;
        heart.style.top = `${Math.random() * 100}%`;
        
        // éšæœºåŠ¨ç”»å‚æ•°ï¼Œå¢åŠ éšæœºæ€§
        const durationOffset = Math.random() * 8; // 0-8ç§’éšæœºæŒç»­æ—¶é—´åç§»
        const xOffset = 20 + Math.random() * 30; // å¢åŠ æ°´å¹³åç§»èŒƒå›´
        const rotation = 30 + Math.random() * 60; // å¢åŠ æ—‹è½¬è§’åº¦èŒƒå›´
        const scale = 0.8 + Math.random() * 0.8; // 0.8-1.6çš„ç¼©æ”¾èŒƒå›´
        const delay = Math.random() * 5; // 0-5ç§’éšæœºå»¶è¿Ÿ
        const direction = Math.random() > 0.5 ? 1 : -1; // æ–¹å‘
        const easing = easings[Math.floor(Math.random() * easings.length)];
        
        // éšæœºé¢œè‰²
        const colors = ['rgba(244, 114, 182, 0.8)', 'rgba(236, 72, 153, 0.8)', 'rgba(192, 132, 252, 0.8)', 'rgba(251, 207, 232, 0.8)', 'rgba(249, 168, 212, 0.8)'];
        heart.style.color = colors[Math.floor(Math.random() * colors.length)];
        
        // è®¾ç½®CSSå˜é‡
        heart.style.setProperty('--duration-offset', `${durationOffset}s`);
        heart.style.setProperty('--x-offset', `${xOffset}px`);
        heart.style.setProperty('--rotation', `${rotation}deg`);
        heart.style.setProperty('--scale', scale);
        heart.style.setProperty('--delay', `${delay}s`);
        heart.style.setProperty('--direction', direction);
        heart.style.setProperty('--easing', easing);
        
        container.appendChild(heart);
      }
    }

    // æ€§èƒ½ä¼˜åŒ–ç›¸å…³ - requestAnimationFrame å…¼å®¹æ€§å¤„ç†
    if (!window.requestAnimationFrame) {
      window.requestAnimationFrame = function (callback, element) {
        let lastTime = 0;
        const currTime = new Date().getTime();
        const timeToCall = Math.max(0, 16 - (currTime - lastTime));
        const id = window.setTimeout(function () {
          callback(currTime + timeToCall);
        }, timeToCall);
        lastTime = currTime + timeToCall;
        return id;
      };
    }

    // é¡µé¢éšè—æ—¶åœæ­¢åŠ¨ç”»ï¼Œæå‡æ€§èƒ½
    let hiddenProperty = 'hidden' in document ? 'hidden' : 
      'webkitHidden' in document ? 'webkitHidden' :
      'mozHidden' in document ? 'mozHidden' :
      null;
    let visibilityChangeEvent = hiddenProperty.replace(/hidden/i, 'visibilitychange');

    document.addEventListener(visibilityChangeEvent, function() {
      if (!document[hiddenProperty]) {
        // é¡µé¢å¯è§æ—¶ï¼Œé‡æ–°å¯åŠ¨åŠ¨ç”»
        if (typeof fireworkSystem !== 'undefined') {
          fireworkSystem.startLaunch();
        }
      }
    });

    // ä¼˜åŒ–äº‹ä»¶ç›‘å¬å™¨
    function debounce(func, wait) {
      let timeout;
      return function() {
        const context = this, args = arguments;
        const later = function() {
          timeout = null;
          func.apply(context, args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // çª—å£è°ƒæ•´å¤§å°æ—¶é‡æ–°è®¡ç®—æ˜Ÿæ˜ŸèƒŒæ™¯
    window.addEventListener('resize', debounce(function() {
      const container = document.getElementById('stars-container');
      while (container.firstChild) {
        container.removeChild(container.firstChild);
      }
      createStarsBackground();
    }, 100));

    // åˆå§‹åŒ–å˜é‡
    let fireworkSystem;
    let music5, music2;

    // æ£€æµ‹ç½‘ç»œçŠ¶å†µ
    function checkNetworkStatus() {
      // ä½¿ç”¨Navigator.connection APIæ£€æµ‹ç½‘ç»œçŠ¶å†µ
      if (navigator.connection) {
        const connection = navigator.connection;
        // è®°å½•ç½‘ç»œç±»å‹å’Œæœ‰æ•ˆå¸¦å®½
        console.log('ç½‘ç»œç±»å‹:', connection.effectiveType);
        
        // æ ¹æ®ç½‘ç»œç±»å‹è¿”å›åŠ è½½ç­–ç•¥
        switch(connection.effectiveType) {
          case 'slow-2g':
          case '2g':
            return { preload: 'none', useLowQuality: true };
          case '3g':
            return { preload: 'metadata', useLowQuality: false };
          case '4g':
          default:
            return { preload: 'metadata', useLowQuality: false };
        }
      }
      // é»˜è®¤ç­–ç•¥
      return { preload: 'metadata', useLowQuality: false };
    }
    
    // æ¸è¿›å¼éŸ³é¢‘åŠ è½½å‡½æ•°
    function progressiveLoadAudio(audio, src) {
      return new Promise((resolve, reject) => {
        // è®¾ç½®åŠ è½½çŠ¶æ€
        audio._loading = true;
        audio._loaded = false;
        
        // ç›‘å¬åŠ è½½è¿›åº¦
        audio.addEventListener('progress', function() {
          if (audio.buffered.length > 0) {
            const bufferedEnd = audio.buffered.end(audio.buffered.length - 1);
            const duration = audio.duration;
            
            if (duration > 0) {
              const percent = (bufferedEnd / duration) * 100;
              console.log(`éŸ³é¢‘åŠ è½½è¿›åº¦: ${percent.toFixed(1)}%`);
              
              // å½“åŠ è½½äº†è¶³å¤Ÿçš„æ•°æ®å°±å¯ä»¥å¼€å§‹æ’­æ”¾
              if (percent > 2) {
                audio._loaded = true;
              }
            }
          }
        });
        
        // åŠ è½½å®Œæˆäº‹ä»¶
        audio.addEventListener('canplaythrough', function() {
          audio._loaded = true;
          audio._loading = false;
          console.log('éŸ³é¢‘å¯ä»¥æµç•…æ’­æ”¾');
          resolve(audio);
        });
        
        // é”™è¯¯å¤„ç†
        audio.addEventListener('error', function(e) {
          audio._loading = false;
          console.error('éŸ³é¢‘åŠ è½½é”™è¯¯:', e);
          reject(e);
        });
        
        // å¼€å§‹åŠ è½½
        audio.src = src;
      });
    }
    
    // åˆå§‹åŒ–éŸ³ä¹å‡½æ•° - ä¼˜åŒ–ç‰ˆ
    function initMusic() {
      console.log('å¼€å§‹åˆå§‹åŒ–éŸ³ä¹å…ƒç´ ...');
      
      // è·å–ç½‘ç»œçŠ¶å†µç­–ç•¥
      const networkPolicy = checkNetworkStatus();
      
      // åˆ›å»º5å·éŸ³ä¹å…ƒç´ ï¼ˆç‚¹å‡»çˆ±å¿ƒæ’­æ”¾ï¼‰
      music5 = new Audio();
      music5.src = '5.m4a';
      music5.type = 'audio/mp4';
      music5.preload = 'none'; // ä¸è‡ªåŠ¨é¢„åŠ è½½ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’
      music5.controls = false; // ä¸æ˜¾ç¤ºæ§åˆ¶æ¡
      
      // åˆ›å»º2å·éŸ³ä¹å…ƒç´ ï¼ˆæŒ‰é’®ç‚¹å‡»åè‡ªåŠ¨æ’­æ”¾ï¼‰
      music2 = new Audio();
      music2.src = '2.m4a';
      music2.type = 'audio/mp4';
      music2.preload = 'none'; // ä¸è‡ªåŠ¨é¢„åŠ è½½ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’
      music2.controls = false; // ä¸æ˜¾ç¤ºæ§åˆ¶æ¡
      
      console.log('éŸ³ä¹å…ƒç´ åˆå§‹åŒ–å®Œæˆ - é‡‡ç”¨æ™ºèƒ½åŠ è½½ç­–ç•¥');
      console.log(`ç½‘ç»œçŠ¶å†µ: ${networkPolicy.preload === 'none' ? 'æ…¢é€Ÿç½‘ç»œï¼Œå»¶è¿ŸåŠ è½½' : 'æ­£å¸¸ç½‘ç»œï¼Œé¢„åŠ è½½å…ƒæ•°æ®'}`);
      
      // æ·»åŠ å¢å¼ºçš„é”™è¯¯å¤„ç†
      function addAudioErrorHandling(audio, name) {
        audio.addEventListener('error', function() {
          console.error(`${name}éŸ³ä¹é”™è¯¯:`, audio.error);
          
          // é”™è¯¯åå°è¯•é‡æ–°åŠ è½½
          if (audio.error && audio.error.code === 2) { // ç½‘ç»œé”™è¯¯
            console.log(`å°è¯•é‡æ–°åŠ è½½${name}...`);
            setTimeout(() => {
              audio.src = audio.src; // é‡æ–°è®¾ç½®srcä»¥è§¦å‘é‡æ–°åŠ è½½
            }, 1000);
          }
        });
        
        // æ·»åŠ åŠ è½½è¶…æ—¶å¤„ç†
        audio.addEventListener('loadstart', function() {
          this._loadTimeout = setTimeout(() => {
            if (!this._loaded) {
              console.warn(`${name}åŠ è½½è¶…æ—¶ï¼Œå°è¯•é™çº§åŠ è½½ç­–ç•¥`);
              this.preload = 'none';
              // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é™çº§åˆ°ä½è´¨é‡ç‰ˆæœ¬çš„é€»è¾‘
            }
          }, 8000); // 8ç§’è¶…æ—¶
        });
        
        // æ¸…é™¤è¶…æ—¶è®¡æ—¶å™¨
        audio.addEventListener('canplay', function() {
          if (this._loadTimeout) {
            clearTimeout(this._loadTimeout);
          }
        });
      }
      
      addAudioErrorHandling(music5, '5å·éŸ³ä¹');
      addAudioErrorHandling(music2, '2å·éŸ³ä¹');
      
      // æ·»åŠ ç”¨æˆ·äº¤äº’æ—¶çš„é¢„åŠ è½½è§¦å‘
      function triggerPreloadOnInteraction() {
        // å½“ç”¨æˆ·é¦–æ¬¡äº¤äº’æ—¶ï¼Œå¼€å§‹é¢„åŠ è½½éŸ³é¢‘
        function startPreloading() {
          console.log('ç”¨æˆ·äº¤äº’ï¼Œå¼€å§‹é¢„åŠ è½½éŸ³é¢‘...');
          
          // æ·»åŠ ç”¨æˆ·äº¤äº’å¯åŠ¨éŸ³é¢‘
      const audioPrompt = document.getElementById('audio-prompt');
      const startAudioBtn = document.getElementById('start-audio-btn');
      
      // éŸ³é¢‘åˆå§‹åŒ–å‡½æ•° - ä¼˜åŒ–ç‰ˆæœ¬
      function initializeAudio() {
        try {
          // ä¸ºå¾®ä¿¡ç¯å¢ƒä¼˜åŒ–çš„é¢„åŠ è½½ç­–ç•¥
          const isWeChat = navigator.userAgent.includes('MicroMessenger');
          console.log('æ£€æµ‹åˆ°ç¯å¢ƒ:', isWeChat ? 'å¾®ä¿¡æµè§ˆå™¨' : 'æ™®é€šæµè§ˆå™¨');
          
          // å¾®ä¿¡ç¯å¢ƒä¸‹ä½¿ç”¨æ›´ä¿å®ˆçš„åŠ è½½ç­–ç•¥
          if (isWeChat) {
            music5.preload = 'metadata'; // åªé¢„åŠ è½½å…ƒæ•°æ®
            music2.preload = 'none'; // å®Œå…¨ä¸é¢„åŠ è½½å¤§æ–‡ä»¶
          } else {
            music5.preload = 'auto';
            music2.preload = 'metadata';
          }
          
          // ç¡®ä¿éŸ³é¢‘å…ƒç´ åº”ç”¨äº†é”™è¯¯å¤„ç†
          addAudioErrorHandling(music5, '5å·');
          addAudioErrorHandling(music2, '2å·');
          
          // æ·»åŠ åŠ è½½çŠ¶æ€ç›‘å¬
          music5.addEventListener('loadeddata', () => {
            console.log('5å·éŸ³ä¹(å°æ–‡ä»¶)åŠ è½½æˆåŠŸ');
            music5._loaded = true;
            
            // 5å·éŸ³ä¹åŠ è½½å®Œæˆåï¼Œå†å¼€å§‹åŠ è½½2å·éŸ³ä¹ï¼ˆå»¶è¿ŸåŠ è½½å¤§æ–‡ä»¶ï¼‰
            if (isWeChat) {
              console.log('å¼€å§‹å»¶è¿ŸåŠ è½½2å·éŸ³ä¹(å¤§æ–‡ä»¶)...');
              setTimeout(() => {
                try {
                  music2.preload = 'auto';
                  music2.load();
                } catch (e) {
                  console.warn('å»¶è¿ŸåŠ è½½2å·éŸ³ä¹æ—¶å‡ºé”™:', e);
                }
              }, 2000); // å»¶è¿Ÿ2ç§’å†åŠ è½½å¤§æ–‡ä»¶
            }
          });
          
          music2.addEventListener('loadeddata', () => {
            console.log('2å·éŸ³ä¹åŠ è½½æˆåŠŸ');
            music2._loaded = true;
          });
          
          // åªç«‹å³åŠ è½½è¾ƒå°çš„5å·éŸ³ä¹æ–‡ä»¶
          try {
            music5.load();
          } catch (e) {
            console.warn('5å·éŸ³ä¹åŠ è½½æ—¶å‡ºé”™ï¼Œä½†ä¸å½±å“ç»§ç»­æ‰§è¡Œ:', e);
          }
          
          // éå¾®ä¿¡ç¯å¢ƒä¸‹å¯ä»¥å°è¯•åŠ è½½2å·éŸ³ä¹
          if (!isWeChat) {
            try {
              music2.load();
            } catch (e) {
              console.warn('2å·éŸ³ä¹åŠ è½½æ—¶å‡ºé”™ï¼Œä½†ä¸å½±å“ç»§ç»­æ‰§è¡Œ:', e);
            }
          }
          
          // éšè—æç¤ºç•Œé¢
          audioPrompt.style.opacity = '0';
          audioPrompt.style.transition = 'opacity 1s ease';
          
          setTimeout(() => {
            audioPrompt.style.display = 'none';
            // å…è®¸é¡µé¢å…¶ä»–äº¤äº’
            document.body.style.overflow = 'auto';
          }, 1000);
          
          console.log('éŸ³é¢‘åˆå§‹åŒ–å®Œæˆï¼Œé‡‡ç”¨å¾®ä¿¡ä¼˜åŒ–çš„åŠ è½½ç­–ç•¥');
        } catch (error) {
          console.error('éŸ³é¢‘åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:', error);
          // å³ä½¿å‡ºé”™ä¹Ÿè¦éšè—æç¤ºç•Œé¢ï¼Œä¿è¯ç”¨æˆ·ä½“éªŒ
          audioPrompt.style.display = 'none';
          document.body.style.overflow = 'auto';
        }
      }
      
      // ç‚¹å‡»æŒ‰é’®åˆå§‹åŒ–éŸ³é¢‘
      startAudioBtn.addEventListener('click', initializeAudio);
      
      // ä¹Ÿå…è®¸ç‚¹å‡»æ•´ä¸ªæç¤ºç•Œé¢åˆå§‹åŒ–
      audioPrompt.addEventListener('click', function(e) {
        if (e.target === audioPrompt) {
          initializeAudio();
        }
      });
          
          // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…é‡å¤è§¦å‘
          document.removeEventListener('click', startPreloading);
          document.removeEventListener('touchstart', startPreloading);
        }
        
        // æ·»åŠ å¤šç§äº¤äº’äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('click', startPreloading, { once: true });
        document.addEventListener('touchstart', startPreloading, { once: true });
      }
      
      triggerPreloadOnInteraction();
    }

    // ä¿®æ”¹åˆå§‹åŒ–å‡½æ•°ï¼Œå­˜å‚¨fireworkSystemå®ä¾‹
    function init() {
      // åˆå§‹åŒ–èƒŒæ™¯éŸ³ä¹
      initMusic();
      // åˆ›å»ºè£…é¥°æ•ˆæœ
      createStartDecor();
      // åˆå§‹åŒ–çƒŸèŠ±ç³»ç»Ÿ
      fireworkSystem = new FireworkSystem();
    }
    
    // å¢å¼ºçš„èƒŒæ™¯åˆ›å»ºå‡½æ•°ï¼Œèåˆæ˜Ÿæ˜Ÿå’Œçˆ±å¿ƒæ•ˆæœï¼Œä¸æŒ‰é’®ç•Œé¢ä¿æŒä¸€è‡´
    function createSweetBg() {
      console.log('åˆ›å»ºèƒŒæ™¯æ•ˆæœ...');
      // é¦–å…ˆæ¸…ç©ºèƒŒæ™¯å®¹å™¨ï¼Œé¿å…é‡å¤æ·»åŠ 
      const bgBox = document.getElementById('bg-decor');
      if (!bgBox) {
        console.error('æœªæ‰¾åˆ°èƒŒæ™¯å®¹å™¨');
        return;
      }
      bgBox.innerHTML = '';
      
      // è·å–æ˜Ÿæ˜Ÿå’Œç²’å­å®¹å™¨
      const starsContainer = document.getElementById('stars-container');
      const particleContainer = document.getElementById('particle-container');
      
      if (!starsContainer || !particleContainer) {
        console.error('æœªæ‰¾åˆ°æ˜Ÿæ˜Ÿæˆ–ç²’å­å®¹å™¨');
        return;
      }
      
      // æ¸…ç©ºç°æœ‰å†…å®¹
      starsContainer.innerHTML = '';
      particleContainer.innerHTML = '';
      
      try {
        // åˆ›å»ºç«‹ä½“çˆ±å¿ƒç²’å­èƒŒæ™¯ï¼Œä¸å¼€å§‹é¡µé¢å®Œå…¨ä¸€è‡´
        createParticleHearts();
      } catch (error) {
        console.warn('åˆ›å»ºçˆ±å¿ƒç²’å­å¤±è´¥:', error);
      }
      
      // åˆ›å»ºæ˜Ÿæ˜ŸèƒŒæ™¯
      createStarsBackground();
      
      // é¢å¤–æ·»åŠ æ›´å¤šé£˜åŠ¨çš„çˆ±å¿ƒï¼Œå¢å¼ºèƒŒæ™¯æ•ˆæœ
      const isMobile = window.innerWidth < 768;
      // å¢åŠ çˆ±å¿ƒæ•°é‡ï¼Œç¡®ä¿èƒŒæ™¯æ•ˆæœä¸°å¯Œ
      const heartCount = isLowEndDevice ? (isMobile ? 150 : 300) : (isMobile ? 200 : 400);
      
      for (let i = 0; i < heartCount; i++) {
        // åˆ›å»ºçˆ±å¿ƒå…ƒç´ ï¼ˆä½¿ç”¨æ–‡æœ¬è€Œä¸æ˜¯Font Awesomeï¼Œç¡®ä¿å…¼å®¹æ€§ï¼‰
        const heart = document.createElement('div');
        heart.innerHTML = 'â¤';
        heart.className = 'bg-heart-float';
        heart.style.position = 'absolute';
        heart.style.left = `${Math.random() * 100}%`;
        heart.style.top = `${Math.random() * 100}%`;
        heart.style.animationDelay = `${Math.random() * 15}s`;
        // éšæœºå¤§å°ï¼Œå¢åŠ å˜åŒ–èŒƒå›´
        const size = 8 + Math.random() * 20;
        heart.style.fontSize = `${size}px`;
        // éšæœºé¢œè‰²ï¼Œä½¿ç”¨æ›´å¤šæ ·çš„ç²‰è‰²ç³»
        const colors = ['#F472B6', '#EC4899', '#C084FC', '#A78BFA', '#F9A8D4', '#FB7185', '#F43F5E'];
        heart.style.color = colors[Math.floor(Math.random() * colors.length)];
        // æ·»åŠ éšæœºé€æ˜åº¦å˜åŒ–
        heart.style.opacity = 0.5 + Math.random() * 0.5;
        // ç¡®ä¿åŠ¨ç”»æ­£å¸¸åº”ç”¨
        heart.style.animation = 'floatAround 8s ease-in-out infinite';
        heart.style.pointerEvents = 'none';
        heart.style.transformOrigin = 'center';
        bgBox.appendChild(heart);
      }
      
      // æ·»åŠ é¢å¤–çš„æ˜Ÿæ˜Ÿï¼Œå¢å¼ºé—ªçƒæ•ˆæœ
      addMoreStars();
    }
    
    // æ·»åŠ æ›´å¤šæ˜Ÿæ˜Ÿæ•ˆæœ
    function addMoreStars() {
      const container = document.getElementById('stars-container');
      const additionalStars = isLowEndDevice ? 200 : 400;
      
      for (let i = 0; i < additionalStars; i++) {
        const star = document.createElement('div');
        star.className = 'bg-star';
        
        // éšæœºå¤§å°
        const size = Math.random() * 3 + 1;
        
        // éšæœºä½ç½®
        const left = Math.random() * 100;
        const top = Math.random() * 100;
        
        // éšæœºåŠ¨ç”»å»¶è¿Ÿ
        const delay = Math.random() * 5;
        
        // éšæœºä¸é€æ˜åº¦
        const opacity = Math.random() * 0.8 + 0.2;
        
        // è®¾ç½®æ ·å¼
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.left = `${left}%`;
        star.style.top = `${top}%`;
        star.style.opacity = opacity;
        star.style.animation = `twinkle ${Math.random() * 3 + 2}s ease-in-out ${delay}s infinite`;
        star.style.position = 'absolute';
        star.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
        star.style.borderRadius = '50%';
        star.style.boxShadow = '0 0 2px 1px rgba(255, 255, 255, 0.7)';
        
        container.appendChild(star);
      }
    }
    
    // åˆå§‹åŒ–ç…§ç‰‡ç”»å»Š
    function initPhotoGallery() {
      const slider = document.getElementById('photo-slider');
      const container = document.getElementById('photo-container');
      const leftBound = document.getElementById('left-bound');
      const rightBound = document.getElementById('right-bound');
// ç…§ç‰‡æ•°æ® - æ·»åŠ æ–‡ä»¶å¤§å°ä¿¡æ¯ç”¨äºä¼˜åŒ–åŠ è½½
      const photos = [
        {src: 'a.jpg', size: 'small'},
        {src: 'b.jpg', size: 'small'},
        {src: 'c.jpg', size: 'small'},
        {src: 'd.jpg', size: 'small'},
        {src: 'e.jpg', size: 'small'},
        {src: 'f.jpg', size: 'small'},
        {src: 'g.jpg', size: 'medium'},
        {src: 'h.jpg', size: 'medium'},
        {src: 'i.jpg', size: 'large'}
      ];
      
      // æ£€æµ‹æ˜¯å¦åœ¨å¾®ä¿¡ç¯å¢ƒ
      const isWeChat = navigator.userAgent.includes('MicroMessenger');
      console.log('è¿è¡Œç¯å¢ƒæ£€æµ‹:', isWeChat ? 'å¾®ä¿¡æµè§ˆå™¨' : 'æ™®é€šæµè§ˆå™¨');
      
      // æ¸…ç©ºsliderå†…å®¹
      slider.innerHTML = '';
      
      // è®¾ç½®slideræ ·å¼ - ä¿®æ”¹ä¸ºå¯æ»šåŠ¨
      slider.style.width = '100%';
      slider.style.display = 'flex';
      slider.style.alignItems = 'center';
      slider.style.overflowX = 'auto'; // å…è®¸æ°´å¹³æ»šåŠ¨
      slider.style.overflowY = 'hidden';
      slider.style.scrollBehavior = 'smooth'; // å¹³æ»‘æ»šåŠ¨
      slider.style.WebkitOverflowScrolling = 'touch'; // ä¼˜åŒ–iOSæ»šåŠ¨ä½“éªŒ
      slider.style.scrollSnapType = 'x mandatory'; // å¯ç”¨æ»šåŠ¨å¸é™„
      slider.style.msOverflowStyle = 'none'; // éšè—æ»šåŠ¨æ¡
      slider.style.scrollbarWidth = 'none'; // éšè—æ»šåŠ¨æ¡
      
      // éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½
      slider.addEventListener('scroll', () => {
        // æ»šåŠ¨æ—¶æ›´æ–°å½“å‰ä½ç½®
        currentTranslateX = -slider.scrollLeft;
        updateBounds();
      });
      
      // åˆ›å»ºèƒ¶å·å®¹å™¨
      const filmRoll = document.createElement('div');
      filmRoll.className = 'film-roll relative';
      filmRoll.style.display = 'flex';
      filmRoll.style.alignItems = 'center';
      filmRoll.style.padding = '50px 20px'; // å¢åŠ ä¸Šä¸‹å†…è¾¹è·ä»¥é€‚åº”æ›´å¤§çš„ç…§ç‰‡å’Œè½¨é“
      filmRoll.style.background = 'linear-gradient(90deg, #87cefa 0%, #ffb6c1 50%, #87cefa 100%)';
      filmRoll.style.borderRadius = '4px';
      
      // åˆ›å»ºä¸Šä¸‹å­”æ´å®¹å™¨ - è°ƒæ•´ä½ç½®ä»¥é€‚åº”æ›´å¤§çš„ç…§ç‰‡
      const topHoles = document.createElement('div');
      topHoles.className = 'film-holes-top absolute left-0 right-0 top-15 flex justify-between px-12';
      const bottomHoles = document.createElement('div');
      bottomHoles.className = 'film-holes-bottom absolute left-0 right-0 bottom-15 flex justify-between px-12';
      
      // æ·»åŠ å¤šä¸ªå­”æ´
      for (let i = 0; i < 15; i++) {
        // ä¸Šéƒ¨å­”æ´
        const topHole = document.createElement('div');
        topHole.className = 'film-hole';
        topHole.style.width = '16px';
        topHole.style.height = '16px';
        topHole.style.borderRadius = '50%';
        topHole.style.background = 'black';
        topHole.style.margin = '0 10px';
        topHoles.appendChild(topHole);
        
        // ä¸‹éƒ¨å­”æ´
        const bottomHole = document.createElement('div');
        bottomHole.className = 'film-hole';
        bottomHole.style.width = '16px';
        bottomHole.style.height = '16px';
        bottomHole.style.borderRadius = '50%';
        bottomHole.style.background = 'black';
        bottomHole.style.margin = '0 10px';
        bottomHoles.appendChild(bottomHole);
      }
      
      filmRoll.appendChild(topHoles);
      filmRoll.appendChild(bottomHoles);
      
      // åˆ›å»ºèƒ¶ç‰‡è½¨é“ - è¿™æ˜¯éœ€è¦æ»‘åŠ¨çš„å…ƒç´ 
      const filmTrack = document.createElement('div');
      filmTrack.className = 'film-track relative flex items-center';
      filmTrack.style.padding = '60px 60px'; // å¢åŠ ä¸Šä¸‹å†…è¾¹è·ä»¥é€‚åº”æ›´å¤§çš„ç…§ç‰‡
      filmTrack.style.background = 'rgba(255, 255, 255, 0.1)';
      filmTrack.style.borderLeft = '2px dashed rgba(255, 255, 255, 0.3)';
      filmTrack.style.borderRight = '2px dashed rgba(255, 255, 255, 0.3)';
      
      // å›¾ç‰‡æ‡’åŠ è½½å‡½æ•° - ä¿®å¤ç‰ˆ
      const lazyLoadImage = (img, src) => {
        if (!img || !src) return;
        
        console.log('å°è¯•åŠ è½½å›¾ç‰‡:', src);
        
        // ç«‹å³è®¾ç½®srcï¼Œä¸ä½¿ç”¨æ‡’åŠ è½½ï¼ˆä¿®å¤ç…§ç‰‡ä¸æ˜¾ç¤ºé—®é¢˜ï¼‰
        const imgObj = new Image();
        imgObj.onload = function() {
          console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ:', src);
          img.src = src;
          img.style.opacity = '1';
          img.style.transform = 'scale(1.05)';
        };
        
        imgObj.onerror = function() {
          console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', src);
          img.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMjAgMjBjMC0xMS4wNCA4Ljk2LTIwIDIwLTIwczIwIDguOTYgMjAgMjBzLTguOTYgMjAtMjAgMjBzLTIwLTguOTYtMjAtMjB6bTUwIDBIMjB2NjBoNTB2LTIwSDYwdjIwSDB2LTIwczIwLTguOTYgMjAtMjBIMTB2ODBoODB2LTIwSDcwdjIwczEwLTEwLjU3IDEwLTIwcy03LjQzLTIwLTIwLTIwSDB2LTIwczIwLTguOTYgMjAtMjBIMTB2NTBINTBWMHY1MEgzMHoiIHN0cm9rZT0iI2ZmNjliNCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsLW9wYWNpdHk9IjAuMSIvPjwvc3ZnPg==';
          img.style.opacity = '1';
        };
        
        // ç«‹å³åŠ è½½å›¾ç‰‡
        imgObj.src = src;
      };
      
      // æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨å¯è§†åŒºåŸŸ
      const isInViewport = (element) => {
        const rect = element.getBoundingClientRect();
        return (
          rect.top <= window.innerHeight * 1.5 && // æå‰åŠ è½½å±å¹•ä¸‹æ–¹50%
          rect.bottom >= -window.innerHeight * 0.5 && // æå‰åŠ è½½å±å¹•ä¸Šæ–¹50%
          rect.left <= window.innerWidth * 1.5 && // æå‰åŠ è½½å±å¹•å³ä¾§50%
          rect.right >= -window.innerWidth * 0.5 // æå‰åŠ è½½å±å¹•å·¦ä¾§50%
        );
      };
      
      // æ‰¹é‡æ£€æŸ¥å¹¶åŠ è½½å¯è§å›¾ç‰‡
      const loadVisibleImages = () => {
        const lazyImages = document.querySelectorAll('img[data-src]:not([data-loading])');
        lazyImages.forEach(img => {
          if (isInViewport(img)) {
            lazyLoadImage(img, img.dataset.src);
          }
        });
      };
      
      // åˆ›å»ºç…§ç‰‡æ¡†æ¶
      const createFilmFrame = (photoSrc, index) => {
        const frame = document.createElement('div');
        frame.className = 'film-frame relative mx-4';
        frame.style.margin = '0 12px'; // å¢åŠ ç…§ç‰‡æ¡†æ¶ä¹‹é—´çš„è¾¹è·ï¼Œé€‚åº”æ›´å¤§çš„ç…§ç‰‡
        frame.style.padding = '2px';
        frame.style.border = '1px solid rgba(255, 255, 255, 0.3)';
        frame.style.backgroundColor = '#000';
        frame.style.scrollSnapAlign = 'center'; // æ»šåŠ¨å¸é™„åˆ°ä¸­å¿ƒ
        
        // ç…§ç‰‡å®¹å™¨
        const photoContainer = document.createElement('div');
        photoContainer.className = 'photo-container relative overflow-hidden';
        // å“åº”å¼ç…§ç‰‡å¤§å°ï¼Œç§»åŠ¨è®¾å¤‡ä¸Šæ›´å°
        const isMobile = window.innerWidth < 768;
        // ç…§ç‰‡å°ºå¯¸è°ƒæ•´ä¸ºæ›´é€‚åˆç§»åŠ¨è®¾å¤‡
        photoContainer.style.width = isMobile ? '280px' : '300px'; // å¢å¤§ç§»åŠ¨è®¾å¤‡ä¸Šçš„å®½åº¦
        photoContainer.style.height = isMobile ? '210px' : '225px'; // å¢å¤§ç§»åŠ¨è®¾å¤‡ä¸Šçš„é«˜åº¦
        photoContainer.style.backgroundColor = '#111';
        
        // ç…§ç‰‡å…ƒç´  - ä¼˜åŒ–ç‰ˆæœ¬ï¼Œç”±loadImageWithRetryå‡½æ•°æ§åˆ¶åŠ è½½
        const img = document.createElement('img');
        // æš‚æ—¶ä¸è®¾ç½®srcï¼Œç”±loadImageWithRetryå‡½æ•°æ§åˆ¶
        img.src = '';
        img.alt = `ç…§ç‰‡ ${index + 1}`;
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'contain';
        img.style.opacity = '0'; // åˆå§‹é€æ˜
        img.style.transition = 'opacity 0.5s ease-in-out';
        img.style.cursor = 'pointer';
        img.style.userSelect = 'none';
        
        // å¾®ä¿¡ç¯å¢ƒä¸‹æ·»åŠ èƒŒæ™¯å›¾ç‰‡æç¤ºæ­£åœ¨åŠ è½½
        if (isWeChat) {
          img.style.backgroundColor = '#f5f5f5';
          // å¯ä»¥æ·»åŠ åŠ è½½ä¸­æ–‡å­—æˆ–å›¾æ ‡
          const loadingText = document.createElement('span');
          loadingText.textContent = 'åŠ è½½ä¸­...';
          loadingText.style.position = 'absolute';
          loadingText.style.fontSize = '12px';
          loadingText.style.color = '#666';
          loadingText.style.zIndex = '1';
          photoContainer.appendChild(loadingText);
          
          // å›¾ç‰‡åŠ è½½å®Œæˆåéšè—åŠ è½½æ–‡å­—
          img.onload = function() {
            this.style.opacity = '1';
            if (loadingText && loadingText.parentNode) {
              loadingText.parentNode.removeChild(loadingText);
            }
          };
        } else {
          // éå¾®ä¿¡ç¯å¢ƒä¸‹çš„åŠ è½½å®Œæˆå¤„ç†
          img.onload = function() {
            this.style.opacity = '1';
          };
        }
        
        // ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
        img.onerror = function() {
          console.error('ç…§ç‰‡åŠ è½½å¤±è´¥:', photoSrc);
          // æ˜¾ç¤ºé”™è¯¯å ä½å›¾
          this.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMjAgMjBjMC0xMS4wNCA4Ljk2LTIwIDIwLTIwczIwIDguOTYgMjAgMjBzLTguOTYgMjAtMjAgMjBzLTIwLTguOTYtMjAtMjB6bTUwIDBIMjB2NjBoNTB2LTIwSDYwdjIwSDB2LTIwczIwLTguOTYgMjAtMjBIMTB2ODBoODB2LTIwSDcwdjIwczEwLTEwLjU3IDEwLTIwcy03LjQzLTIwLTIwLTIwSDB2LTIwczIwLTguOTYgMjAtMjBIMTB2NTBINTBWMHY1MEgzMHoiIHN0cm9rZT0iI2ZmNjliNCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsLW9wYWNpdHk9IjAuMSIvPjwvc3ZnPg==';
          this.style.opacity = '1';
          
          // ç§»é™¤åŠ è½½æ–‡å­—
          const loadingText = photoContainer.querySelector('span');
          if (loadingText) {
            photoContainer.removeChild(loadingText);
          }
        };
        
        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        img.addEventListener('click', function(e) {
          const rect = this.getBoundingClientRect();
          const clickX = rect.left + rect.width / 2;
          const clickY = rect.top + rect.height / 2;
          explodeDanmuAtPosition(clickX, clickY);
        });
        
        photoContainer.appendChild(img);
        frame.appendChild(photoContainer);
        
        return frame;
      };
      
      // é‡æ–°è®¾è®¡çš„å›¾ç‰‡åŠ è½½ç­–ç•¥ - å®ç°çœŸæ­£çš„æ‡’åŠ è½½ã€å¹¶å‘æ§åˆ¶å’Œç§»åŠ¨è®¾å¤‡ä¼˜åŒ–
      const loadPhotos = () => {
        console.log('å¼€å§‹åˆå§‹åŒ–å›¾ç‰‡æ‡’åŠ è½½ç­–ç•¥ï¼Œå¾®ä¿¡ç¯å¢ƒ:', isWeChat);
        
        // æ€§èƒ½ä¼˜åŒ–ï¼šæ£€æµ‹è®¾å¤‡æ€§èƒ½å’Œç½‘ç»œçŠ¶å†µ
        const isLowEndDevice = /Android [4-7]|iPhone OS [8-9]|iPad OS [1-3]/.test(navigator.userAgent);
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        console.log('è®¾å¤‡æ€§èƒ½æ£€æµ‹:', isLowEndDevice ? 'ä½ç«¯è®¾å¤‡' : 'é«˜ç«¯è®¾å¤‡');
        
        // å›¾ç‰‡è´¨é‡ä¼˜åŒ–é…ç½® - æé™å‹ç¼©è®¾ç½®
        const imageQualityConfig = {
          // æ ¹æ®è®¾å¤‡æ€§èƒ½å’Œå¾®ä¿¡ç¯å¢ƒè°ƒæ•´å›¾ç‰‡è´¨é‡
          highQuality: isWeChat ? 0.25 : (isLowEndDevice ? 0.4 : 0.5), // å¾®ä¿¡ç¯å¢ƒä¸‹æé™å‹ç¼©åˆ°0.25
          lowQuality: isWeChat ? 0.1 : (isLowEndDevice ? 0.2 : 0.3),  // å¾®ä¿¡ç¯å¢ƒä¸‹æé™å‹ç¼©åˆ°0.1
          maxWidth: isWeChat ? 320 : (isLowEndDevice ? 480 : 640),    // å¾®ä¿¡ç¯å¢ƒä¸‹æé™å‹ç¼©åˆ°320px
          maxHeight: isWeChat ? 240 : (isLowEndDevice ? 360 : 480)     // å¾®ä¿¡ç¯å¢ƒä¸‹æé™å‹ç¼©åˆ°240px
        };
        
        // å›¾ç‰‡ä¼˜åŒ–å‡½æ•°
        function optimizeImageUrl(src, quality = 'highQuality') {
          // å¦‚æœæ˜¯æœ¬åœ°å›¾ç‰‡ï¼Œç›´æ¥è¿”å›ï¼ˆæ— æ³•å‹ç¼©ï¼‰
          if (src.startsWith('data:') || src.includes('.svg')) {
            return src;
          }
          
          // è·å–è´¨é‡å‚æ•°ï¼Œå¾®ä¿¡ç¯å¢ƒä¸‹ä½¿ç”¨æé™å‹ç¼©
        let qualityValue = imageQualityConfig[quality];
        // å¾®ä¿¡ç¯å¢ƒä¸‹å†é™ä½è´¨é‡20%ï¼Œå®ç°æé™å‹ç¼©
        if (isWeChat) {
          qualityValue = qualityValue * 0.8;
        }
        
        // æœ€å¤§å®½åº¦ï¼Œå¾®ä¿¡ç¯å¢ƒä¸‹ä½¿ç”¨æ›´å°çš„å®½åº¦
        const maxWidth = isWeChat ? imageQualityConfig.maxWidth * 0.7 : imageQualityConfig.maxWidth;
          
          // å¯¹äºæ‰€æœ‰å›¾ç‰‡æœåŠ¡éƒ½å°è¯•æ·»åŠ å‹ç¼©å‚æ•°
          // å³ä½¿æœåŠ¡ä¸æ”¯æŒï¼Œè¿™äº›å‚æ•°é€šå¸¸ä¼šè¢«å¿½ç•¥
          const separator = src.includes('?') ? '&' : '?';
          
          // æ·»åŠ æ›´å…¨é¢çš„å‹ç¼©å‚æ•°
          return `${src}${separator}quality=${Math.round(qualityValue * 100)}&width=${Math.round(maxWidth)}&format=webp`;
        }
        
        // å›¾ç‰‡é¢„åŠ è½½ä¼˜åŒ–å‡½æ•°
        function preloadOptimizedImage(src, callback) {
          const img = new Image();
          
          // ä½¿ç”¨ä¼˜åŒ–åçš„URL
          const optimizedSrc = optimizeImageUrl(src, 'lowQuality');
          
          img.onload = function() {
            // å›¾ç‰‡åŠ è½½å®Œæˆåï¼Œå¦‚æœéœ€è¦è¿›ä¸€æ­¥å‹ç¼©ï¼Œä½¿ç”¨canvas
            if (img.width > imageQualityConfig.maxWidth || img.height > imageQualityConfig.maxHeight) {
              const canvas = document.createElement('canvas');
              const ctx = canvas.getContext('2d');
              
              // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
              const scale = Math.min(
                imageQualityConfig.maxWidth / img.width,
                imageQualityConfig.maxHeight / img.height
              );
              
              const newWidth = Math.floor(img.width * scale);
              const newHeight = Math.floor(img.height * scale);
              
              canvas.width = newWidth;
              canvas.height = newHeight;
              
              // ç»˜åˆ¶å‹ç¼©åçš„å›¾ç‰‡
              ctx.drawImage(img, 0, 0, newWidth, newHeight);
              
              // è½¬æ¢ä¸ºé«˜è´¨é‡JPEGï¼ˆæ–‡ä»¶å¤§å°æ›´å°ï¼‰
              const compressedDataUrl = canvas.toDataURL('image/jpeg', imageQualityConfig.highQuality);
              callback(compressedDataUrl);
            } else {
              // å›¾ç‰‡å°ºå¯¸åˆé€‚ï¼Œç›´æ¥ä½¿ç”¨
              callback(optimizedSrc);
            }
          };
          
          img.onerror = function() {
            console.warn('å›¾ç‰‡é¢„åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹URL:', src);
            callback(src); // é™çº§åˆ°åŸå§‹URL
          };
          
          img.src = optimizedSrc;
        }
        
        // æ€§èƒ½ç›‘æ§æ•°æ®
        const performanceData = {
          totalImages: 0,
          loadedImages: 0,
          failedImages: 0,
          loadTimes: [],
          startTime: null,
          endTime: null,
          totalLoadTime: 0
        };
        
        // æ€§èƒ½æŠ¥å‘Šå‡½æ•°
        function generatePerformanceReport() {
          const report = {
            deviceInfo: {
              isMobile,
              isLowEndDevice,
              isWeChat,
              screen: `${window.innerWidth}x${window.innerHeight}`,
              memory: navigator.deviceMemory ? navigator.deviceMemory + 'GB' : 'æœªçŸ¥',
              cores: navigator.hardwareConcurrency || 'æœªçŸ¥',
              connection: navigator.connection ? {
                type: navigator.connection.effectiveType || 'æœªçŸ¥',
                downlink: navigator.connection.downlink || 'æœªçŸ¥',
                rtt: navigator.connection.rtt || 'æœªçŸ¥'
              } : 'æœªçŸ¥'
            },
            loadStats: {
              totalImages: performanceData.totalImages,
              loadedImages: performanceData.loadedImages,
              failedImages: performanceData.failedImages,
              successRate: performanceData.totalImages > 0 ? 
                Math.round((performanceData.loadedImages / performanceData.totalImages) * 100) + '%' : '0%',
              totalLoadTime: performanceData.totalLoadTime + 'ms',
              avgLoadTime: performanceData.loadTimes.length > 0 ? 
                Math.round(performanceData.loadTimes.reduce((a, b) => a + b, 0) / performanceData.loadTimes.length) + 'ms' : '0ms'
            }
          };
          
          console.log('===== å›¾ç‰‡åŠ è½½æ€§èƒ½æŠ¥å‘Š =====');
          console.log(JSON.stringify(report, null, 2));
          console.log('=========================');
          
          // åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤ºç®€å•çš„æ€§èƒ½æŒ‡æ ‡
          if (isMobile && window.innerWidth < 768) {
            setTimeout(() => {
              const perfDiv = document.createElement('div');
              perfDiv.style.position = 'fixed';
              perfDiv.style.bottom = '20px';
              perfDiv.style.right = '20px';
              perfDiv.style.padding = '10px';
              perfDiv.style.backgroundColor = 'rgba(0,0,0,0.7)';
              perfDiv.style.color = 'white';
              perfDiv.style.fontSize = '12px';
              perfDiv.style.borderRadius = '4px';
              perfDiv.style.zIndex = '9999';
              perfDiv.style.maxWidth = '200px';
              perfDiv.innerHTML = `
                <div>å›¾ç‰‡åŠ è½½æ€§èƒ½ï¼š</div>
                <div>åŠ è½½ç‡: ${report.loadStats.successRate}</div>
                <div>å¹³å‡åŠ è½½: ${report.loadStats.avgLoadTime}</div>
                <div>ç½‘ç»œ: ${report.deviceInfo.connection.type || 'æœªçŸ¥'}</div>
                <div style="margin-top: 5px; opacity: 0.7; font-size: 10px;">ç‚¹å‡»éšè—</div>
              `;
              perfDiv.onclick = () => {
                perfDiv.style.display = 'none';
              };
              document.body.appendChild(perfDiv);
            }, 3000);
          }
        }
        
        // æ ¹æ®è®¾å¤‡æ€§èƒ½è®¾ç½®æœ€å¤§å¹¶å‘æ•° - å¾®ä¿¡ç¯å¢ƒä¸‹å®ç°å•çº¿ç¨‹åŠ è½½
        const maxConcurrentLoads = isWeChat ? 1 : (isLowEndDevice ? 1 : 2);
        console.log('æœ€å¤§å¹¶å‘åŠ è½½æ•°:', maxConcurrentLoads, 'å¾®ä¿¡ç¯å¢ƒ:', isWeChat);
        
        // å¹¶å‘æ§åˆ¶ç®¡ç†å™¨
        const loadQueue = [];
        let currentLoads = 0;
        
        // ç®€å•æœ‰æ•ˆçš„ç¼“å­˜ç ´åå‡½æ•°
        const addCacheBuster = (url) => {
          // ä½¿ç”¨éšæœºæ•°+æ—¶é—´æˆ³åŒé‡ç¼“å­˜ç ´åï¼Œç¡®ä¿æ¯æ¬¡URLéƒ½ä¸åŒ
          const random = Math.random().toString(36).substring(2, 15);
          const timestamp = new Date().getTime();
          return url.includes('?') ? `${url}&v=${timestamp}_${random}` : `${url}?v=${timestamp}_${random}`;
        };
        
        // æ£€æµ‹å…ƒç´ æ˜¯å¦åœ¨å¯è§†åŒºåŸŸï¼ˆæ‡’åŠ è½½æ ¸å¿ƒé€»è¾‘ï¼‰
        const isElementInViewport = (element, threshold = 1.5) => {
          const rect = element.getBoundingClientRect();
          return (
            rect.top <= window.innerHeight * threshold && // æå‰åŠ è½½å±å¹•ä¸‹æ–¹50%
            rect.bottom >= -window.innerHeight * 0.5 && // æå‰åŠ è½½å±å¹•ä¸Šæ–¹50%
            rect.left <= window.innerWidth * threshold && // æå‰åŠ è½½å±å¹•å³ä¾§50%
            rect.right >= -window.innerWidth * 0.5 // æå‰åŠ è½½å±å¹•å·¦ä¾§50%
          );
        };
        
        // æ£€æŸ¥å¹¶å¤„ç†é˜Ÿåˆ—ä¸­çš„å›¾ç‰‡åŠ è½½ - ä¼˜åŒ–å¾®ä¿¡ç¯å¢ƒä¸‹çš„åŠ è½½ç­–ç•¥
        const processQueue = () => {
          // æ ¹æ®ä¼˜å…ˆçº§å’Œä½ç½®æ’åºé˜Ÿåˆ—
          const priorityOrder = { 'high': 0, 'medium': 1, 'low': 2 };
          loadQueue.sort((a, b) => {
            // é¦–å…ˆæŒ‰ä¼˜å…ˆçº§æ’åº
            const priorityDiff = (priorityOrder[a.priority] || 2) - (priorityOrder[b.priority] || 2);
            if (priorityDiff !== 0) return priorityDiff;
            
            // ä¼˜å…ˆçº§ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ£€æŸ¥ä½ç½®ä¼˜å…ˆçº§
            const containerA = a.img.closest('.photo-frame');
            const containerB = b.img.closest('.photo-frame');
            
            // è§†å£å†…çš„ä¼˜å…ˆ
            const isAInView = containerA && isElementInViewport(containerA);
            const isBInView = containerB && isElementInViewport(containerB);
            if (isAInView && !isBInView) return -1;
            if (!isAInView && isBInView) return 1;
            
            // éƒ½åœ¨è§†å£å†…æˆ–éƒ½ä¸åœ¨ï¼ŒæŒ‰ç´¢å¼•æ’åº
            return a.index - b.index;
          });
          
          // å¾®ä¿¡ç¯å¢ƒä¸‹çš„æ›´æ¿€è¿›å¤„ç†ï¼šä¸€æ¬¡åªå¤„ç†ä¸€ä¸ªé«˜ä¼˜å…ˆçº§å›¾ç‰‡
          if (isWeChat) {
            // å¾®ä¿¡ç¯å¢ƒä¸‹ï¼Œåªå¤„ç†é«˜ä¼˜å…ˆçº§å›¾ç‰‡ï¼Œç›´åˆ°é«˜ä¼˜å…ˆçº§å›¾ç‰‡å¤„ç†å®Œ
            const highPriorityIndex = loadQueue.findIndex(item => item.priority === 'high');
            
            if (highPriorityIndex > -1 && currentLoads < maxConcurrentLoads) {
              const { img, src, index } = loadQueue.splice(highPriorityIndex, 1)[0];
              console.log(`å¾®ä¿¡ç¯å¢ƒä¸‹ä¼˜å…ˆåŠ è½½é«˜ä¼˜å…ˆçº§å›¾ç‰‡${index + 1}ï¼Œå½“å‰å¹¶å‘æ•°:`, currentLoads + 1);
              loadImage(img, src, index);
            } else if (highPriorityIndex === -1 && currentLoads < maxConcurrentLoads && loadQueue.length > 0) {
              // æ²¡æœ‰é«˜ä¼˜å…ˆçº§å›¾ç‰‡æ—¶ï¼Œå¤„ç†å…¶ä»–å›¾ç‰‡
              const { img, src, index } = loadQueue.shift();
              console.log(`å¾®ä¿¡ç¯å¢ƒä¸‹åŠ è½½ä¸­ç­‰ä¼˜å…ˆçº§å›¾ç‰‡${index + 1}ï¼Œå½“å‰å¹¶å‘æ•°:`, currentLoads + 1);
              loadImage(img, src, index);
            }
          } else {
            // éå¾®ä¿¡ç¯å¢ƒï¼Œæ ¹æ®æœ€å¤§å¹¶å‘æ•°åŠ è½½å¤šä¸ªå›¾ç‰‡
            while (loadQueue.length > 0 && currentLoads < maxConcurrentLoads) {
              const { img, src, index } = loadQueue.shift();
              console.log(`ä»é˜Ÿåˆ—å–å‡ºå›¾ç‰‡${index + 1} (ä¼˜å…ˆçº§:${img.priority || 'normal'})ï¼Œå½“å‰å¹¶å‘æ•°:`, currentLoads + 1);
              loadImage(img, src, index);
            }
          }
        };
        
        // æ£€æŸ¥å…ƒç´ æ˜¯å¦æ¥è¿‘è§†å£ï¼ˆç”¨äºæå‰åŠ è½½ï¼‰
        function isNearViewport(element) {
          const rect = element.getBoundingClientRect();
          const viewHeight = Math.max(document.documentElement.clientHeight, window.innerHeight);
          const viewWidth = Math.max(document.documentElement.clientWidth, window.innerWidth);
          
          return (
            rect.top >= -viewHeight * 1.5 &&
            rect.left >= -viewWidth * 0.5 &&
            rect.bottom <= viewHeight * 2.5 &&
            rect.right <= viewWidth * 1.5
          );
        }
        
        // å›¾ç‰‡åŠ è½½å‡½æ•° - å¢å¼ºç‰ˆï¼ˆå¸¦å¹¶å‘æ§åˆ¶ï¼‰
        const loadImage = (img, src, index) => {
          console.log(`å¼€å§‹åŠ è½½å›¾ç‰‡${index + 1}:`, src);
          
          // é˜²æ­¢é‡å¤åŠ è½½
          if (img.dataset.loaded === 'true' || img.dataset.loading === 'true') {
            processQueue(); // è§¦å‘é˜Ÿåˆ—å¤„ç†
            return;
          }
          
          // æ ‡è®°ä¸ºåŠ è½½ä¸­å¹¶å¢åŠ å¹¶å‘è®¡æ•°
          img.dataset.loading = 'true';
          currentLoads++;
          
          // é‡ç½®æ‰€æœ‰äº‹ä»¶å¤„ç†
          img.onload = null;
          img.onerror = null;
          
          // è®¾ç½®åˆå§‹çŠ¶æ€
          img.style.opacity = '0';
          
          // è·å–æˆ–åˆ›å»ºåŠ è½½çŠ¶æ€æ–‡æœ¬
          // è·å–çˆ¶å®¹å™¨å¹¶æ·»åŠ ç›¸å¯¹å®šä½
          const container = img.parentNode;
          container.style.position = 'relative';
          
          // åˆ›å»ºéª¨æ¶å±å ä½ç¬¦
          let skeleton = container.querySelector('.skeleton-placeholder');
          if (!skeleton) {
            skeleton = document.createElement('div');
            skeleton.className = 'skeleton-placeholder';
            skeleton.style.position = 'absolute';
            skeleton.style.top = '0';
            skeleton.style.left = '0';
            skeleton.style.width = '100%';
            skeleton.style.height = '100%';
            skeleton.style.background = 'linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%)';
            skeleton.style.backgroundSize = '200% 100%';
            skeleton.style.animation = 'skeleton-loading 1.5s infinite';
            skeleton.style.zIndex = '1';
            
            // æ·»åŠ éª¨æ¶å±åŠ¨ç”»æ ·å¼
            if (!document.querySelector('#skeleton-style')) {
              const style = document.createElement('style');
              style.id = 'skeleton-style';
              style.textContent = `
                @keyframes skeleton-loading {
                  0% { background-position: 200% 0; }
                  100% { background-position: -200% 0; }
                }
                .skeleton-pulse {
                  animation: skeleton-pulse 1.5s ease-in-out infinite;
                }
                @keyframes skeleton-pulse {
                  0%, 100% { opacity: 0.6; }
                  50% { opacity: 0.4; }
                }
              `;
              document.head.appendChild(style);
            }
            
            container.appendChild(skeleton);
          }
          
          // è·å–æˆ–åˆ›å»ºåŠ è½½çŠ¶æ€æ–‡æœ¬
          let loadingText = container.querySelector('.loading-text');
          if (!loadingText) {
            loadingText = document.createElement('div');
            loadingText.className = 'loading-text';
            loadingText.style.position = 'absolute';
            loadingText.style.fontSize = '12px';
            loadingText.style.color = '#666';
            loadingText.style.zIndex = '2';
            loadingText.style.textAlign = 'center';
            loadingText.style.width = '100%';
            loadingText.style.top = '50%';
            loadingText.style.transform = 'translateY(-50%)';
            loadingText.style.textShadow = '0 1px 2px rgba(255,255,255,0.8)';
            container.appendChild(loadingText);
          }
          loadingText.textContent = 'åŠ è½½ä¸­...';
          loadingText.classList.add('skeleton-pulse');
          
          // åˆ›å»ºåŠ è½½è¿›åº¦æŒ‡ç¤ºå™¨
          let progressIndicator = container.querySelector('.progress-indicator');
          if (!progressIndicator) {
            progressIndicator = document.createElement('div');
            progressIndicator.className = 'progress-indicator';
            progressIndicator.style.position = 'absolute';
            progressIndicator.style.bottom = '0';
            progressIndicator.style.left = '0';
            progressIndicator.style.height = '3px';
            progressIndicator.style.width = '30%';
            progressIndicator.style.background = '#4CAF50';
            progressIndicator.style.animation = 'progress-loading 2s ease-in-out infinite';
            progressIndicator.style.zIndex = '2';
            
            if (!document.querySelector('#progress-style')) {
              const style = document.createElement('style');
              style.id = 'progress-style';
              style.textContent = `
                @keyframes progress-loading {
                  0% { width: 0%; }
                  100% { width: 80%; }
                }
              `;
              document.head.appendChild(style);
            }
            
            container.appendChild(progressIndicator);
          }
          
          // åˆ›å»ºImageå¯¹è±¡è¿›è¡Œé¢„åŠ è½½
          const imgObj = new Image();
          
          // è®°å½•å¼€å§‹åŠ è½½æ—¶é—´
          const imgStartTime = performance.now();
          performanceData.totalImages++;
          if (!performanceData.startTime) {
            performanceData.startTime = imgStartTime;
          }
          
          // ä½¿ç”¨å›¾ç‰‡ä¼˜åŒ–åŠŸèƒ½
          const optimizedSrc = optimizeImageUrl(src, 'lowQuality');
          const srcWithCacheBuster = addCacheBuster(optimizedSrc);
          console.log(`å›¾ç‰‡${index + 1}ä½¿ç”¨ä¼˜åŒ–URL:`, srcWithCacheBuster, 'åŸå§‹URL:', src);
          
          // è®¾ç½®åŠ è½½æˆåŠŸå¤„ç†
          imgObj.onload = function() {
            const loadTime = performance.now() - imgStartTime;
            performanceData.loadTimes.push(loadTime);
            performanceData.loadedImages++;
            performanceData.endTime = performance.now();
            performanceData.totalLoadTime = performanceData.endTime - performanceData.startTime;
            
            console.log(`å›¾ç‰‡${index + 1}åŠ è½½æˆåŠŸï¼Œè€—æ—¶: ${loadTime.toFixed(2)}ms`, src);
            
            // å›¾ç‰‡åŠ è½½å®Œæˆåè¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–å¤„ç†
            const finalOptimizeImage = new Image();
            finalOptimizeImage.onload = function() {
              try {
                // å¦‚æœå›¾ç‰‡å°ºå¯¸è¿‡å¤§ï¼Œä½¿ç”¨canvasè¿›ä¸€æ­¥å‹ç¼©
                if (finalOptimizeImage.width > imageQualityConfig.maxWidth || finalOptimizeImage.height > imageQualityConfig.maxHeight) {
                  const canvas = document.createElement('canvas');
                  const ctx = canvas.getContext('2d');
                  
                  // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
                  const scale = Math.min(
                    imageQualityConfig.maxWidth / finalOptimizeImage.width,
                    imageQualityConfig.maxHeight / finalOptimizeImage.height
                  );
                  
                  const newWidth = Math.floor(finalOptimizeImage.width * scale);
                  const newHeight = Math.floor(finalOptimizeImage.height * scale);
                  
                  canvas.width = newWidth;
                  canvas.height = newHeight;
                  
                  // é«˜è´¨é‡å‹ç¼©
                  ctx.drawImage(finalOptimizeImage, 0, 0, newWidth, newHeight);
                  const compressedDataUrl = canvas.toDataURL('image/jpeg', imageQualityConfig.highQuality);
                  
                  // ä½¿ç”¨å‹ç¼©åçš„å›¾ç‰‡
                  img.src = compressedDataUrl;
                  console.log(`å›¾ç‰‡${index + 1}å·²å‹ç¼©: ${finalOptimizeImage.width}x${finalOptimizeImage.height} -> ${newWidth}x${newHeight}`);
                } else {
                  // å›¾ç‰‡å°ºå¯¸åˆé€‚ï¼Œç›´æ¥ä½¿ç”¨
                  img.src = srcWithCacheBuster;
                }
                
                // å¹³æ»‘è¿‡æ¸¡æ˜¾ç¤ºå›¾ç‰‡
                img.style.opacity = '1';
                img.dataset.loaded = 'true';
                img.dataset.loading = 'false';
              } catch (error) {
                console.error(`å›¾ç‰‡${index + 1}ä¼˜åŒ–å¤„ç†å¤±è´¥:`, error);
                // ä¼˜åŒ–å¤±è´¥æ—¶ç›´æ¥ä½¿ç”¨åŸå§‹URL
                img.src = srcWithCacheBuster;
                img.style.opacity = '1';
                img.dataset.loaded = 'true';
                img.dataset.loading = 'false';
              }
            };
            
            finalOptimizeImage.onerror = function() {
              console.error(`å›¾ç‰‡${index + 1}ä¼˜åŒ–å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹URL`);
              // ä¼˜åŒ–å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ç›´æ¥ä½¿ç”¨åŸå§‹URL
              img.src = srcWithCacheBuster;
              img.style.opacity = '1';
              img.dataset.loaded = 'true';
              img.dataset.loading = 'false';
            };
            
            finalOptimizeImage.src = srcWithCacheBuster;
            
            // å‡å°‘å¹¶å‘è®¡æ•°å¹¶å¤„ç†ä¸‹ä¸€ä¸ªé˜Ÿåˆ—é¡¹
            currentLoads--;
            processQueue();
            
            // ç§»é™¤æ‰€æœ‰å ä½ç¬¦å…ƒç´ 
            if (skeleton && skeleton.parentNode) {
              skeleton.parentNode.removeChild(skeleton);
            }
            if (loadingText && loadingText.parentNode) {
              loadingText.parentNode.removeChild(loadingText);
            }
            if (progressIndicator && progressIndicator.parentNode) {
              progressIndicator.parentNode.removeChild(progressIndicator);
            }
            
            // å½“æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆï¼Œç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
            if (performanceData.loadedImages + performanceData.failedImages === photos.length) {
              generatePerformanceReport();
            }
          };
          
          // è®¾ç½®åŠ è½½å¤±è´¥å¤„ç†å’Œé‡è¯•é€»è¾‘
          let retryCount = 0;
          const maxRetries = isLowEndDevice ? 5 : 3; // ä½ç«¯è®¾å¤‡å¢åŠ é‡è¯•æ¬¡æ•°
          
          imgObj.onerror = function() {
            retryCount++;
            console.error(`å›¾ç‰‡${index + 1}åŠ è½½å¤±è´¥ (ç¬¬${retryCount}æ¬¡):`, src);
            
            if (loadingText) {
              loadingText.textContent = `åŠ è½½å¤±è´¥ï¼Œé‡è¯•ä¸­(${retryCount}/${maxRetries})...`;
              loadingText.style.color = '#ff9800';
            }
            
            // é‡è¯•æœºåˆ¶
            if (retryCount <= maxRetries) {
              // æŒ‡æ•°é€€é¿ç­–ç•¥ï¼Œä½ç«¯è®¾å¤‡å¢åŠ å»¶è¿Ÿæ—¶é—´
              const baseDelay = isLowEndDevice ? 1500 : 1000;
              const delay = Math.min(Math.pow(2, retryCount - 1) * baseDelay, 8000);
              console.log(`å°†åœ¨${delay}msåç¬¬${retryCount}æ¬¡é‡è¯•åŠ è½½å›¾ç‰‡${index + 1}`);
              
              setTimeout(() => {
                // æ¯æ¬¡é‡è¯•éƒ½ä½¿ç”¨æ–°çš„ä¼˜åŒ–å’Œç¼“å­˜ç ´åURL
                const newOptimizedSrc = optimizeImageUrl(src, 'lowQuality');
                const newSrcWithCacheBuster = addCacheBuster(newOptimizedSrc);
                console.log(`å›¾ç‰‡${index + 1}ç¬¬${retryCount}æ¬¡é‡è¯•ä½¿ç”¨ä¼˜åŒ–URL:`, newSrcWithCacheBuster);
                imgObj.src = newSrcWithCacheBuster;
              }, delay);
            } else {
              performanceData.failedImages++;
              performanceData.endTime = performance.now();
              if (performanceData.startTime) {
                performanceData.totalLoadTime = performanceData.endTime - performanceData.startTime;
              }
              
              console.error(`å›¾ç‰‡${index + 1}åœ¨${maxRetries}æ¬¡é‡è¯•åä»ç„¶å¤±è´¥:`, src);
              // æ˜¾ç¤ºé”™è¯¯å ä½å›¾
              img.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBkPSJNMjAgMjBjMC0xMS4wNCA4Ljk2LTIwIDIwLTIwczIwIDguOTYgMjAgMjBzLTguOTYgMjAtMjAgMjBzLTIwLTguOTYtMjAtMjB6bTUwIDBIMjB2NjBoNTB2LTIwSDYwdjIwSDB2LTIwczIwLTguOTYgMjAtMjBIMTB2ODBoODB2LTIwSDcwdjIwczEwLTEwLjU3IDEwLTIwcy03LjQzLTIwLTIwLTIwSDB2LTIwczIwLTguOTYgMjAtMjBIMTB2NTBINTBWMHY1MEgzMHoiIHN0cm9rZT0iI2ZmNjliNCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsLW9wYWNpdHk9IjAuMSIvPjwvc3ZnPg==';
              img.style.opacity = '1';
              img.dataset.loading = 'false';
              
              // å‡å°‘å¹¶å‘è®¡æ•°å¹¶å¤„ç†ä¸‹ä¸€ä¸ªé˜Ÿåˆ—é¡¹
              currentLoads--;
              processQueue();
              
              // å½“æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆæˆ–å¤±è´¥ï¼Œç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
              if (performanceData.loadedImages + performanceData.failedImages === photos.length) {
                generatePerformanceReport();
              }
              
              // æ›´æ–°é”™è¯¯çŠ¶æ€ï¼Œæ·»åŠ é‡è¯•æŒ‰é’®
              if (loadingText) {
                loadingText.textContent = 'åŠ è½½å¤±è´¥';
                loadingText.style.color = '#ff4444';
                loadingText.classList.remove('skeleton-pulse');
              }
              
              // ç§»é™¤éª¨æ¶å±å’Œè¿›åº¦æ¡
              if (skeleton && skeleton.parentNode) {
                skeleton.parentNode.removeChild(skeleton);
              }
              if (progressIndicator && progressIndicator.parentNode) {
                progressIndicator.parentNode.removeChild(progressIndicator);
              }
              
              // æ·»åŠ é‡è¯•æŒ‰é’®
              let retryButton = container.querySelector('.retry-button');
              if (!retryButton) {
                retryButton = document.createElement('button');
                retryButton.className = 'retry-button';
                retryButton.textContent = 'é‡è¯•';
                retryButton.style.position = 'absolute';
                retryButton.style.bottom = '20px';
                retryButton.style.left = '50%';
                retryButton.style.transform = 'translateX(-50%)';
                retryButton.style.padding = '8px 16px';
                retryButton.style.backgroundColor = '#f44336';
                retryButton.style.color = 'white';
                retryButton.style.border = 'none';
                retryButton.style.borderRadius = '4px';
                retryButton.style.fontSize = '14px';
                retryButton.style.cursor = 'pointer';
                retryButton.style.zIndex = '3';
                retryButton.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';
                retryButton.style.userSelect = 'none';
                
                // æ·»åŠ é‡è¯•ç‚¹å‡»äº‹ä»¶
                retryButton.onclick = () => {
                  console.log(`ç”¨æˆ·ç‚¹å‡»é‡è¯•æŒ‰é’®ï¼Œé‡æ–°åŠ è½½å›¾ç‰‡${index + 1}`);
                  // é‡ç½®çŠ¶æ€
                  img.dataset.loaded = 'false';
                  img.dataset.loading = 'false';
                  img.style.opacity = '0';
                  
                  // ç§»é™¤é‡è¯•æŒ‰é’®
                  retryButton.parentNode.removeChild(retryButton);
                  
                  // é‡æ–°åŠ è½½å›¾ç‰‡
                  loadImage(img, src, index);
                };
                
                // ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ–
                retryButton.ontouchstart = (e) => {
                  e.preventDefault();
                  retryButton.style.backgroundColor = '#d32f2f';
                };
                
                retryButton.ontouchend = (e) => {
                  e.preventDefault();
                  retryButton.style.backgroundColor = '#f44336';
                  retryButton.click();
                };
                
                container.appendChild(retryButton);
              }
            }
          };
          
          // å¾®ä¿¡ç¯å¢ƒç‰¹æ®Šå¤„ç†
          if (isWeChat) {
            // å¾®ä¿¡ç¯å¢ƒä¸‹å»¶è¿Ÿ200msåŠ è½½ï¼Œé¿å…åŒæ—¶åŠ è½½è¿‡å¤šèµ„æº
            setTimeout(() => {
              imgObj.src = srcWithCacheBuster;
            }, 200);
          } else {
            // æ™®é€šç¯å¢ƒç›´æ¥åŠ è½½
            imgObj.src = srcWithCacheBuster;
          }
        };
        
        // æ‡’åŠ è½½å¤„ç†å‡½æ•°ï¼ˆæ”¯æŒå¹¶å‘æ§åˆ¶ï¼‰
        const handleLazyLoad = () => {
          const lazyImages = Array.from(document.querySelectorAll('img[data-src]:not([data-loaded="true"]):not([data-loading="true"])'));
          
          // åˆ†ç¦»é¦–å±å’Œéé¦–å±å›¾ç‰‡
          const viewportImages = [];
          const nearViewportImages = [];
          const farViewportImages = [];
          
          lazyImages.forEach(img => {
            if (isElementInViewport(img, 1.0)) { // ä¸¥æ ¼åœ¨è§†å£å†…çš„è§†ä¸ºé¦–å±
              viewportImages.push(img);
            } else if (isNearViewport(img)) { // æ¥è¿‘è§†å£çš„å›¾ç‰‡
              nearViewportImages.push(img);
            } else { // è¾ƒè¿œçš„å›¾ç‰‡
              farViewportImages.push(img);
            }
          });
          
          // é¦–å±å›¾ç‰‡ç«‹å³åŠ è½½ï¼Œä¸ç­‰å¾…
          if (viewportImages.length > 0) {
            console.log(`å‘ç°${viewportImages.length}å¼ é¦–å±å›¾ç‰‡ï¼Œç«‹å³åŠ è½½`);
            viewportImages.forEach(img => {
              const isInQueue = loadQueue.some(item => item.img === img);
              if (!isInQueue) {
                loadQueue.unshift({
                  img,
                  src: img.dataset.src,
                  index: parseInt(img.dataset.index || 0),
                  priority: 'high'
                });
              }
            });
          }
          
          // å¾®ä¿¡ç¯å¢ƒä¸‹çš„æ¿€è¿›ç­–ç•¥ï¼šåªæœ‰å½“é¦–å±å›¾ç‰‡åŠ è½½å®Œæˆåæ‰åŠ è½½æ¥è¿‘è§†å£çš„å›¾ç‰‡
          const areViewportImagesLoaded = document.querySelectorAll('img[data-loaded="true"]').length > 0;
          
          if ((isWeChat && areViewportImagesLoaded) || !isWeChat) {
            // æ¥è¿‘è§†å£çš„å›¾ç‰‡æŒ‰ä¼˜å…ˆçº§æ’åºå¹¶æ·»åŠ åˆ°é˜Ÿåˆ—
            if (nearViewportImages.length > 0) {
              nearViewportImages.sort((a, b) => {
                const rectA = a.getBoundingClientRect();
                const rectB = b.getBoundingClientRect();
                
                // ç®€åŒ–çš„ä¼˜å…ˆçº§è®¡ç®—ï¼Œä¼˜å…ˆåŠ è½½é è¿‘é¡¶éƒ¨çš„å›¾ç‰‡
                const priorityA = Math.abs(rectA.top + rectA.height/2) + Math.abs(rectA.left + rectA.width/2);
                const priorityB = Math.abs(rectB.top + rectB.height/2) + Math.abs(rectB.left + rectB.width/2);
                
                return priorityA - priorityB;
              });
              
              nearViewportImages.forEach(img => {
                const isInQueue = loadQueue.some(item => item.img === img);
                if (!isInQueue) {
                  loadQueue.push({
                    img,
                    src: img.dataset.src,
                    index: parseInt(img.dataset.index || 0),
                    priority: 'medium'
                  });
                }
              });
            }
            
            // å¾®ä¿¡ç¯å¢ƒä¸‹å»¶è¿ŸåŠ è½½è¿œå¤„çš„å›¾ç‰‡ï¼Œéå¾®ä¿¡ç¯å¢ƒå¯ä»¥é€‚é‡åŠ è½½
            if (farViewportImages.length > 0 && (!isWeChat || Math.random() > 0.7)) {
              // éšæœºé€‰æ‹©å°‘é‡è¿œå¤„çš„å›¾ç‰‡é¢„åŠ è½½
              const selectedCount = Math.min(2, farViewportImages.length);
              const shuffled = [...farViewportImages].sort(() => 0.5 - Math.random());
              const selected = shuffled.slice(0, selectedCount);
              
              selected.forEach(img => {
                const isInQueue = loadQueue.some(item => item.img === img);
                if (!isInQueue) {
                  loadQueue.push({
                    img,
                    src: img.dataset.src,
                    index: parseInt(img.dataset.index || 0),
                    priority: 'low'
                  });
                }
              });
            }
          }
          
          console.log(`åŠ è½½é˜Ÿåˆ—çŠ¶æ€ - é¦–å±:${viewportImages.length}, æ¥è¿‘:${nearViewportImages.length}, è¿œå¤„:${farViewportImages.length}`);
          console.log(`å½“å‰é˜Ÿåˆ—é•¿åº¦: ${loadQueue.length}`);
          
          // å¤„ç†é˜Ÿåˆ—ä¸­çš„å›¾ç‰‡
          processQueue();
          
          // å¦‚æœæ‰€æœ‰å›¾ç‰‡éƒ½å·²åŠ è½½ï¼Œç§»é™¤äº‹ä»¶ç›‘å¬
          if (document.querySelectorAll('img[data-src]:not([data-loaded="true"])').length === 0) {
            console.log('æ‰€æœ‰å›¾ç‰‡åŠ è½½å®Œæˆï¼Œç§»é™¤æ‡’åŠ è½½äº‹ä»¶ç›‘å¬');
            window.removeEventListener('scroll', handleLazyLoad);
            window.removeEventListener('resize', handleLazyLoad);
            window.removeEventListener('orientationchange', handleLazyLoad);
          }
        };
        
        // å…ˆåŠ è½½æ‰€æœ‰å›¾ç‰‡æ¡†æ¶ï¼Œä½†ä¸åŠ è½½å›¾ç‰‡å†…å®¹
        const frames = [];
        photos.forEach((photoObj, index) => {
          const frame = createFilmFrame(photoObj.src, index);
          filmTrack.appendChild(frame);
          
          // è·å–å›¾ç‰‡å…ƒç´ å¹¶è®¾ç½®dataå±æ€§ç”¨äºæ‡’åŠ è½½
          const img = frame.querySelector('img');
          img.dataset.src = photoObj.src; // å­˜å‚¨çœŸå®å›¾ç‰‡è·¯å¾„
          img.dataset.index = index; // å­˜å‚¨ç´¢å¼•
          img.src = ''; // æ¸…ç©ºsrcé¿å…ç«‹å³åŠ è½½
          
          frames.push({frame, photoObj, index, img});
        });
        
        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ä»¥è§¦å‘æ‡’åŠ è½½
        window.addEventListener('scroll', handleLazyLoad, { passive: true });
        window.addEventListener('resize', handleLazyLoad, { passive: true });
        window.addEventListener('orientationchange', handleLazyLoad, { passive: true });
        
        // ç§»åŠ¨ç«¯è§¦æ‘¸æ»šåŠ¨ä¼˜åŒ–
        if ('ontouchstart' in window) {
          let scrollTimeout;
          slider.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(handleLazyLoad, 100);
          }, { passive: true });
        }
        
        // åˆå§‹æ£€æŸ¥ï¼ŒåŠ è½½é¦–å±å›¾ç‰‡
        setTimeout(() => {
          console.log('æ‰§è¡Œåˆå§‹æ‡’åŠ è½½æ£€æŸ¥');
          handleLazyLoad();
        }, 100);
        
        // 3ç§’åå¼ºåˆ¶æ£€æŸ¥ä¸€æ¬¡ï¼Œç¡®ä¿æ²¡æœ‰é—æ¼çš„å›¾ç‰‡
        setTimeout(() => {
          console.log('æ‰§è¡Œå»¶è¿Ÿæ‡’åŠ è½½æ£€æŸ¥');
          handleLazyLoad();
        }, 3000);
        
        console.log('å›¾ç‰‡æ‡’åŠ è½½ç­–ç•¥å·²åˆå§‹åŒ–');
      };
      
      // å¸¦é‡è¯•æœºåˆ¶çš„å›¾ç‰‡åŠ è½½å‡½æ•° - å¤‡ç”¨ç‰ˆæœ¬
      function loadImageWithRetry(imgElement, src, index) {
        console.log(`å°è¯•åŠ è½½å›¾ç‰‡${index + 1}:`, src);
        
        imgElement.onload = function() {
          console.log(`å›¾ç‰‡${index + 1}åŠ è½½æˆåŠŸ:`, src);
          this.style.opacity = '1';
        };
        
        imgElement.onerror = function() {
          console.error(`å›¾ç‰‡${index + 1}åŠ è½½å¤±è´¥:`, src);
          setTimeout(() => {
            console.log(`é‡è¯•åŠ è½½å›¾ç‰‡${index + 1}:`, src);
            this.src = src;
          }, 1000);
        };
        
        imgElement.src = src;
      }
      
      // æ‰§è¡Œç®€åŒ–çš„åŠ è½½ç­–ç•¥
      loadPhotos();
      
      // ç§»é™¤ä¸å¿…è¦çš„äº‹ä»¶ç›‘å¬å™¨
      // ä¸å†éœ€è¦æ‡’åŠ è½½ç›¸å…³çš„äº‹ä»¶ç›‘å¬
      
      // ç¡®ä¿ç…§ç‰‡å®¹å™¨æœ‰åˆé€‚çš„èƒŒæ™¯é¢œè‰²ï¼Œé¿å…æ˜¾ç¤ºé»‘è‰²
      slider.querySelectorAll('.photo-container').forEach(container => {
        container.style.backgroundColor = '#222';
        container.style.display = 'flex';
        container.style.alignItems = 'center';
        container.style.justifyContent = 'center';
      });
      
      // å°†è½¨é“æ·»åŠ åˆ°èƒ¶å·
      filmRoll.appendChild(filmTrack);
      
      // å°†èƒ¶å·æ·»åŠ åˆ°slider
      slider.appendChild(filmRoll);
      
      // æ·»åŠ CSSæ ·å¼
      const style = document.createElement('style');
      style.textContent = `
        /* èƒ¶å·æ ·å¼ */
        .film-roll {
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        /* æ»šåŠ¨æ¡éšè—ä½†ä¿æŒåŠŸèƒ½ */
        #photo-container::-webkit-scrollbar {
          display: none;
        }
        #photo-container {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        
        /* èƒ¶ç‰‡æ¡†æ¶æ‚¬åœæ•ˆæœ */
        .film-frame:hover {
          transform: scale(1.02);
          transition: transform 0.3s ease;
        }
        
        /* ç¡®ä¿å­”æ´å›ºå®šä½ç½® */
        .film-holes-top, .film-holes-bottom {
          pointer-events: none;
        }
        
        /* ä¿®å¤ç§»åŠ¨è®¾å¤‡ä¸Šçš„æ»šåŠ¨é—®é¢˜ */
        @media (max-width: 768px) {
          /* ç¡®ä¿æ‰€æœ‰å¯èƒ½æ¶‰åŠæ»šåŠ¨çš„å®¹å™¨éƒ½æœ‰æ­£ç¡®è®¾ç½® */
          #photo-container,
          #photo-slider,
          .film-roll,
          .film-track {
            overflow-x: auto !important;
            -webkit-overflow-scrolling: touch !important;
            scroll-behavior: smooth;
            transform: translateZ(0); /* å¯ç”¨ç¡¬ä»¶åŠ é€Ÿ */
            -webkit-transform: translateZ(0); /* Safariå…¼å®¹æ€§ */
          }
          
          /* ç¡®ä¿è½¨é“å…ƒç´ è¶³å¤Ÿçµæ´» */
          .film-track {
            will-change: transform; /* ä¼˜åŒ–æ€§èƒ½ */
            flex-shrink: 0;
          }
          
          /* ç¦ç”¨ä¸å¿…è¦çš„è§¦æ‘¸äº‹ä»¶å¹²æ‰° */
          .film-frame img {
            pointer-events: none;
          }
          
          /* ç¡®ä¿æ•´ä¸ªæ»‘åŠ¨åŒºåŸŸå¯ä»¥å“åº”è§¦æ‘¸ */
          #photo-slider {
            touch-action: pan-x;
            user-select: none;
          }
        }
      `;
      document.head.appendChild(style);
        
        // æ»‘åŠ¨ç›¸å…³å˜é‡
        let startX, moveX, currentTranslateX = 0;
        let isDragging = false;
        
        // å®¹å™¨å®½åº¦
        let containerWidth = container.offsetWidth;
        // æœ€å¤§å¯æ»šåŠ¨è·ç¦»
        let maxScrollDistance = 0;
        
        // è®¡ç®—æœ€å¤§æ»šåŠ¨è·ç¦»çš„å‡½æ•°
        function calculateMaxScroll() {
          // ä½¿ç”¨requestAnimationFrameç¡®ä¿DOMå·²æ¸²æŸ“
          requestAnimationFrame(() => {
            maxScrollDistance = Math.max(0, slider.scrollWidth - slider.clientWidth);
            updateBounds();
          });
          
          // åŒé‡ä¿é™©ï¼Œå†æ¬¡è®¡ç®—ä»¥ç¡®ä¿å‡†ç¡®æ€§
          setTimeout(() => {
            maxScrollDistance = Math.max(0, slider.scrollWidth - slider.clientWidth);
            updateBounds();
          }, 300);
        }
        
        // æ›´æ–°å·¦å³ç•Œé™æŒ‡ç¤ºå™¨
        function updateBounds() {
          const currentScroll = slider.scrollLeft;
          leftBound.classList.toggle('hidden', currentScroll <= 10); // ç•™ä¸€ç‚¹ä½™é‡
          rightBound.classList.toggle('hidden', currentScroll >= maxScrollDistance - 10); // ç•™ä¸€ç‚¹ä½™é‡
        }
        
        // è§¦æ‘¸å¼€å§‹äº‹ä»¶ - ä¼˜åŒ–ç§»åŠ¨è®¾å¤‡å…¼å®¹æ€§
        slider.addEventListener('touchstart', (e) => {
          startX = e.touches[0].clientX;
          isDragging = true;
          // ç§»é™¤å¹³æ»‘æ»šåŠ¨ä»¥ä¾¿æ‹–æ‹½æ—¶æ›´æµç•…
          slider.style.scrollBehavior = 'auto';
        }, { passive: true });
        
        // è§¦æ‘¸ç§»åŠ¨äº‹ä»¶ - ä¼˜åŒ–ç§»åŠ¨è®¾å¤‡å…¼å®¹æ€§
        slider.addEventListener('touchmove', (e) => {
          if (!isDragging) return;
          
          // ä½¿ç”¨è¢«åŠ¨æ¨¡å¼å¹¶é¿å…preventDefaultï¼Œè¿™åœ¨ç°ä»£ç§»åŠ¨æµè§ˆå™¨ä¸­è¡¨ç°æ›´å¥½
          moveX = e.touches[0].clientX;
          const diff = startX - moveX;
          
          // ç›´æ¥æ“ä½œæ»šåŠ¨ä½ç½®ï¼Œå¹¶å¢åŠ æ»‘åŠ¨ç³»æ•°ä½¿æ»‘åŠ¨æ›´çµæ•
          slider.scrollLeft += diff * 1.2; // å¢åŠ 1.2å€çš„æ»‘åŠ¨é€Ÿåº¦
          startX = moveX;
          
          // æ›´æ–°è¾¹ç•ŒæŒ‡ç¤ºå™¨
          updateBounds();
        }, { passive: true });
        
        // è§¦æ‘¸ç»“æŸäº‹ä»¶ - æ·»åŠ æƒ¯æ€§æ•ˆæœ
        slider.addEventListener('touchend', () => {
          if (!isDragging) return;
          
          // æ¢å¤å¹³æ»‘æ»šåŠ¨
          slider.style.scrollBehavior = 'smooth';
          isDragging = false;
          
          // æ›´æ–°è¾¹ç•ŒæŒ‡ç¤ºå™¨
          updateBounds();
          
          // ç¡®ä¿ç…§ç‰‡å®Œå…¨æ˜¾ç¤ºï¼Œé¿å…å¡åœ¨ä¸­é—´çŠ¶æ€
          setTimeout(() => {
            const scrollPosition = slider.scrollLeft;
            const frameWidth = 280; // å‡è®¾æ¯ä¸ªç…§ç‰‡æ¡†æ¶çš„å¤§è‡´å®½åº¦
            const frameIndex = Math.round(scrollPosition / frameWidth);
            slider.scrollTo({ left: frameIndex * frameWidth, behavior: 'smooth' });
          }, 100);
        });
        
        // é¼ æ ‡æ‹–æ‹½äº‹ä»¶ï¼ˆæ¡Œé¢ç«¯ï¼‰
        slider.addEventListener('mousedown', (e) => {
          startX = e.clientX;
          isDragging = true;
          slider.style.scrollBehavior = 'auto';
        });
        
        document.addEventListener('mousemove', (e) => {
          if (!isDragging) return;
          
          moveX = e.clientX;
          const diff = startX - moveX;
          
          slider.scrollLeft += diff;
          startX = moveX;
          
          // æ›´æ–°è¾¹ç•ŒæŒ‡ç¤ºå™¨
          updateBounds();
        });
        
        document.addEventListener('mouseup', () => {
          if (!isDragging) return;
          
          slider.style.scrollBehavior = 'smooth';
          isDragging = false;
          
          // æ›´æ–°è¾¹ç•ŒæŒ‡ç¤ºå™¨
          updateBounds();
        });
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è®¡ç®—
        window.addEventListener('resize', () => {
          const newContainerWidth = container.offsetWidth;
          containerWidth = newContainerWidth;
          calculateMaxScroll();
        });
      
      // åˆå§‹åŒ–è®¡ç®—æœ€å¤§æ»šåŠ¨è·ç¦»
      calculateMaxScroll();
      
      // åˆå§‹åŒ–æ˜¾ç¤º
      updateBounds();
      
      // 3ç§’åéšè—æç¤º
      setTimeout(() => {
        const hint = document.getElementById('swipe-hint');
        hint.style.transition = 'opacity 0.5s';
        hint.style.opacity = '0';
        setTimeout(() => hint.remove(), 500);
      }, 3000);
    }
    
    // åœ¨æŒ‡å®šä½ç½®çˆ†ç‚¸å¼¹å¹•
    function explodeDanmuAtPosition(x, y) {
      // å®šä¹‰å››ä¸ªåŒºåŸŸçš„é…ç½®
      const regions = [
        {
          name: 'å·¦ä¸Š',
          xOffsetRange: [-60, -20], // xåç§»èŒƒå›´ï¼ˆåƒç´ ï¼‰
          yOffsetRange: [-60, -20], // yåç§»èŒƒå›´ï¼ˆåƒç´ ï¼‰
          angleRange: [Math.PI * 1.5, Math.PI * 1.875] // è§’åº¦èŒƒå›´ï¼ˆå·¦ä¸ŠåŒºåŸŸï¼‰
        },
        {
          name: 'å³ä¸Š',
          xOffsetRange: [20, 60],
          yOffsetRange: [-60, -20],
          angleRange: [Math.PI * 1.875, 0] // å³ä¸ŠåŒºåŸŸ
        },
        {
          name: 'å·¦ä¸‹',
          xOffsetRange: [-60, -20],
          yOffsetRange: [20, 60],
          angleRange: [Math.PI * 1.125, Math.PI * 1.5] // å·¦ä¸‹åŒºåŸŸ
        },
        {
          name: 'å³ä¸‹',
          xOffsetRange: [20, 60],
          yOffsetRange: [20, 60],
          angleRange: [0, Math.PI * 0.375] // å³ä¸‹åŒºåŸŸ
        }
      ];
      
      // ä¸ºæ¯ä¸ªåŒºåŸŸç”Ÿæˆå¼¹å¹•
      regions.forEach((region, regionIndex) => {
        // æ¯ä¸ªåŒºåŸŸç”Ÿæˆ1-2æ¡å¼¹å¹•
        const count = Math.floor(Math.random() * 2) + 1;
        
        for (let i = 0; i < count; i++) {
          // è®¡ç®—å¼¹å¹•çš„èµ·å§‹ä½ç½®ï¼ˆåŒºåŸŸå†…éšæœºï¼‰
          const xOffset = Math.random() * (region.xOffsetRange[1] - region.xOffsetRange[0]) + region.xOffsetRange[0];
          const yOffset = Math.random() * (region.yOffsetRange[1] - region.yOffsetRange[0]) + region.yOffsetRange[0];
          const startX = x + xOffset;
          const startY = y + yOffset;
          
          // éšæœºé€‰æ‹©å¼¹å¹•æ–‡æœ¬å’Œå¤§å°
          const textIndex = Math.floor(Math.random() * texts.length);
          const isBig = Math.random() > 0.7;
          const danmu = createDanmu(texts[textIndex], isBig);
          
          // è®¾ç½®åˆå§‹ä½ç½®
          danmu.style.left = `${startX}px`;
          danmu.style.top = `${startY}px`;
          danmu.style.transform = 'translate(-50%, -50%) scale(0)';
          danmu.style.opacity = '0';
          
          // éšæœºé€‰æ‹©ä¸¤ç§ä¸åŒçš„é¢œè‰²åˆ›å»ºæ¸å˜æ•ˆæœ
          const color1 = colors[Math.floor(Math.random() * colors.length)];
          let color2;
          do {
            color2 = colors[Math.floor(Math.random() * colors.length)];
          } while (color1 === color2); // ç¡®ä¿ä¸¤ç§é¢œè‰²ä¸åŒ
          
          const header = danmu.querySelector('.danmu-header');
          const content = danmu.querySelector('.danmu-content');
          
          if (header && content) {
            // ä½¿ç”¨æµ…è“ç´«æ¸å˜è‰²
            const gradientAngle = Math.floor(Math.random() * 360); // éšæœºæ¸å˜è§’åº¦
            header.style.background = `linear-gradient(${gradientAngle}deg, ${color1} 0%, ${color2} 100%)`;
            // ä½¿ç”¨æ·±è‰²æ–‡æœ¬ä»¥ç¡®ä¿åœ¨æ¸å˜èƒŒæ™¯ä¸Šçš„å¯è¯»æ€§
            content.style.color = '#333333';
            // ç¡®ä¿æ ‡é¢˜æ–‡å­—ä¹Ÿæ˜¯æ·±è‰²
            const title = header.querySelector('.danmu-title');
            if (title) {
              title.style.color = '#333333';
            }
          }
          
          // æ·»åŠ åˆ°body
          document.body.appendChild(danmu);
          
          // è®¡ç®—ç§»åŠ¨æ–¹å‘å’Œè·ç¦»
          // ç¡®ä¿è§’åº¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
          let angle;
          if (region.angleRange[0] <= region.angleRange[1]) {
            angle = Math.random() * (region.angleRange[1] - region.angleRange[0]) + region.angleRange[0];
          } else {
            // å¤„ç†è·¨è¿‡0åº¦çš„èŒƒå›´
            const range1 = Math.PI * 2 - region.angleRange[0];
            const range2 = region.angleRange[1];
            const totalRange = range1 + range2;
            const randomPoint = Math.random() * totalRange;
            
            if (randomPoint < range1) {
              angle = region.angleRange[0] + randomPoint;
            } else {
              angle = randomPoint - range1;
            }
          }
          
          // å±å¹•å¯¹è§’çº¿é•¿åº¦ä½œä¸ºå‚è€ƒè·ç¦»
          const diagonal = Math.sqrt(window.innerWidth * window.innerWidth + window.innerHeight * window.innerHeight);
          const distance = diagonal * (Math.random() * 0.8 + 0.6); // å¯¹è§’çº¿é•¿åº¦çš„60%-140%
          
          // è®¡ç®—ç»ˆç‚¹ä½ç½®
          const endX = startX + Math.cos(angle) * distance;
          const endY = startY + Math.sin(angle) * distance;
          
          // è®¾ç½®åŠ¨ç”»å»¶è¿Ÿï¼ˆåŒºåŸŸé—´é—´éš”200msï¼ŒåŒºåŸŸå†…å¼¹å¹•é—´éš”150msï¼‰
          const delay = regionIndex * 200 + i * 150;
          
          // å¯åŠ¨åŠ¨ç”»
          setTimeout(() => {
            // ç¬¬ä¸€é˜¶æ®µï¼šæ”¾å¤§å‡ºç°ï¼ˆ0.4ç§’ï¼‰
            danmu.style.transition = 'transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s ease';
            danmu.style.transform = 'translate(-50%, -50%) scale(1)';
            danmu.style.opacity = '1';
            
            // ç¬¬äºŒé˜¶æ®µï¼šç§»åŠ¨ï¼ˆ1.8-3ç§’ï¼‰
            setTimeout(() => {
              const moveDuration = Math.random() * 1.2 + 1.8; // 1.8-3ç§’
              danmu.style.transition = `transform ${moveDuration}s ease-out, opacity ${moveDuration}s ease`;
              danmu.style.transform = `translate(calc(-50% + ${endX - startX}px), calc(-50% + ${endY - startY}px)) scale(1)`;
              
              // ç¬¬ä¸‰é˜¶æ®µï¼šæ¶ˆå¤±
              setTimeout(() => {
                danmu.style.transition = 'opacity 0.8s ease';
                danmu.style.opacity = '0';
                
                // æ¸…ç†å…ƒç´ 
                setTimeout(() => {
                  if (document.body.contains(danmu)) {
                    document.body.removeChild(danmu);
                  }
                }, 800);
              }, moveDuration * 1000 - 800); // æå‰800mså¼€å§‹æ¶ˆå¤±
            }, 400);
          }, delay);
        }
      });
    }
    
    // è¾…åŠ©å‡½æ•°ï¼šè°ƒæ•´é¢œè‰²äº®åº¦
    function adjustBrightness(color, percent) {
      // è§£æé¢œè‰²
      let R = parseInt(color.substring(1, 3), 16);
      let G = parseInt(color.substring(3, 5), 16);
      let B = parseInt(color.substring(5, 7), 16);
      
      // è°ƒæ•´äº®åº¦
      R = Math.max(0, Math.min(255, R + percent));
      G = Math.max(0, Math.min(255, G + percent));
      B = Math.max(0, Math.min(255, B + percent));
      
      // è½¬æ¢å›åå…­è¿›åˆ¶
      return '#' + 
        Math.round(R).toString(16).padStart(2, '0') + 
        Math.round(G).toString(16).padStart(2, '0') + 
        Math.round(B).toString(16).padStart(2, '0');
      }
      
    // åˆ›å»ºå¼¹å¹•å…ƒç´ 
    function createDanmu(text, isBig = false) {
      const danmu = document.createElement('div');
      danmu.className = `danmu ${isBig ? 'big-danmu' : ''}`;
      
      // åˆ›å»ºå¼¹å¹•å¤´éƒ¨
      const header = document.createElement('div');
      header.className = 'danmu-header';
      
      // æ·»åŠ ä¸‰ä¸ªç‚¹
      for (let i = 0; i < 3; i++) {
        const dot = document.createElement('div');
        dot.className = 'danmu-dot';
        header.appendChild(dot);
      }
      
      // æ·»åŠ æ ‡é¢˜
      const title = document.createElement('div');
      title.className = 'danmu-title';
      title.textContent = 'çˆ±çš„å‘Šç™½';
      header.appendChild(title);
      
      // æ·»åŠ å†…å®¹
      const content = document.createElement('div');
      content.className = 'danmu-content';
      content.textContent = text;
      
      // ç»„è£…å¼¹å¹•
      danmu.appendChild(header);
      danmu.appendChild(content);
      
      return danmu;
      }
  </script>
</body>
</html>